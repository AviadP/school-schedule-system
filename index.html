<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>××¢×¨×›×ª ×©×¢×•×ª ××™× ×˜×¨××§×˜×™×‘×™×ª - ×’×¨×¡×” ××ª×•×§× ×ª</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .instructions {
            background-color: #e3f2fd;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .button-group {
            margin: 20px 0;
            text-align: center;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background-color: #45a049;
        }
        #processBtn {
            background-color: #2196F3;
        }
        #processBtn:hover {
            background-color: #0976d2;
        }
        #clearBtn {
            background-color: #f44336;
        }
        #clearBtn:hover {
            background-color: #da190b;
        }
        #debugBtn {
            background-color: #ff9800;
        }
        #debugBtn:hover {
            background-color: #e68900;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: center;
            position: relative;
        }
        th {
            background-color: #4CAF50;
            color: white;
            font-weight: bold;
        }
        .time-cell {
            background-color: #e8f5e9;
            font-weight: bold;
        }
        select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            background-color: white;
        }
        select.selected {
            background-color: #fff3e0;
            font-weight: bold;
        }
        select.synced {
            background-color: #e8f5e9;
            border: 2px solid #4CAF50;
        }
        #output {
            margin-top: 20px;
            display: none;
        }
        .stats {
            background-color: #fff3e0;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
        .legend {
            display: flex;
            gap: 20px;
            margin: 15px 0;
            padding: 10px;
            background-color: #f5f5f5;
            border-radius: 5px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .legend-box {
            width: 20px;
            height: 20px;
            border: 1px solid #ddd;
        }
        .selected-box {
            background-color: #fff3e0;
        }
        .synced-box {
            background-color: #e8f5e9;
            border: 2px solid #4CAF50;
        }
        #debugInfo {
            background-color: #f0f0f0;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ• ××¢×¨×›×ª ×©×¢×•×ª ××™× ×˜×¨××§×˜×™×‘×™×ª - ×’×¨×¡×” ××ª×•×§× ×ª</h1>
        
        <div class="instructions">
            <h3>×”×•×¨××•×ª ×©×™××•×©:</h3>
            <ol>
                <li>×œ×—×¥ ×¢×œ "×¦×•×¨ ××¢×¨×›×ª" ×›×“×™ ×œ×™×¦×•×¨ ×˜×‘×œ×” ×¢× ×ª×¤×¨×™×˜×™× × ×¤×ª×—×™×</li>
                <li>×‘×—×¨ ×©×™×¢×•×¨×™× ××”×ª×¤×¨×™×˜×™× - ×©×™×¢×•×¨×™× ×–×”×™× (××•×ª×• ×©×, ××•×¨×” ×•×•×¨×™×× ×˜) ×™×¡×•×× ×• ××•×˜×•××˜×™×ª</li>
                <li>×”××¢×¨×›×ª ×ª×–×”×” ×”×ª× ×’×©×•×™×•×ª ×•×ª××¤×©×¨ ×œ×š ×œ×‘×—×•×¨ ×× ×œ×”×—×œ×™×£ ××• ×œ×©××•×¨ ××ª ×”×§×™×™×</li>
                <li>×¨×§×¢ ×›×ª×•× = × ×‘×—×¨ ×™×“× ×™×ª | ×¨×§×¢ ×™×¨×•×§ = ×¡×•× ×›×¨×Ÿ ××•×˜×•××˜×™×ª</li>
                <li>×”×©×ª××© ×‘"× ×§×” ×‘×—×™×¨×•×ª" ×›×“×™ ×œ×”×ª×—×™×œ ××—×“×©</li>
                <li>×œ×—×¥ ×¢×œ "×™×™×¦× ×œ××§×¡×œ" ×›×“×™ ×œ×”×•×¨×™×“ ××ª ×”××¢×¨×›×ª ×©×‘×—×¨×ª</li>
            </ol>
        </div>

        <div class="button-group">
            <button id="processBtn">×¦×•×¨ ××¢×¨×›×ª</button>
            <button id="clearBtn" style="display:none;">× ×§×” ×‘×—×™×¨×•×ª</button>
            <button id="exportBtn" style="display:none;">×™×™×¦× ×œ××§×¡×œ</button>
            <button id="debugBtn" style="display:none;">×”×¦×’ ××™×“×¢ ×“×™×‘××’</button>
        </div>

        <div id="debugInfo"></div>

        <div class="legend" style="display:none;">
            <div class="legend-item">
                <div class="legend-box selected-box"></div>
                <span>× ×‘×—×¨ ×™×“× ×™×ª</span>
            </div>
            <div class="legend-item">
                <div class="legend-box synced-box"></div>
                <span>×¡×•× ×›×¨×Ÿ ××•×˜×•××˜×™×ª</span>
            </div>
        </div>

        <div id="stats" class="stats" style="display:none;">
            <h3>×¡×˜×˜×™×¡×˜×™×§×•×ª:</h3>
            <p id="statsContent"></p>
        </div>

        <div id="output">
            <h2>××¢×¨×›×ª ×©×¢×•×ª - ×‘×—×¨ ×©×™×¢×•×¨×™× ××”×ª×¤×¨×™×˜×™×:</h2>
            <div id="tableContainer"></div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
        // × ×ª×•× ×™× ××ª×•×§× ×™× - ×›×œ ×”×©×™×¢×•×¨×™× ×¢×•×“×›× ×•
        const fullScheduleData = {
            "08:30-09:20": { // ×©×™×¢×•×¨ 1
                "×": [
                    {course: "××¤×’×©×™× ×’'", variant: "1", teacher: "×¨×•×‘×™"},
                    {course: "××¤×’×©×™× ×’'", variant: "2", teacher: "×•×¨×“"},
                    {course: "××¤×’×©×™× ×“'", variant: "1", teacher: "×™×•×‘×œ"},
                    {course: "××¤×’×©×™× ×“'", variant: "2", teacher: "×¤××˜××”"},
                    {course: "××¤×’×©×™× ×“'", variant: "3", teacher: "××•×¨×Ÿ"},
                    {course: "×¡×¤×¨×™×™×”", variant: "", teacher: "×—×œ×™"}
                ],
                "×‘": [
                    {course: "×× ×’×œ×™×ª 2", variant: "1", teacher: "××™×›×œ"},
                    {course: "×× ×’×œ×™×ª 2", variant: "3", teacher: "×”×œ×œ"},
                    {course: "×‘×¨×—×•×‘×•×ª ×©×œ× ×•", variant: "2", teacher: "×©×—×¨"},
                    {course: "××”××˜×‘×— ×‘××”×‘×”", variant: "", teacher: "×”×“×¨"},
                    {course: "×¡×¤×¨×™×™×”", variant: "", teacher: "×—×œ×™"},
                    {course: "×¢×‘×¨×™×ª 1", variant: "1", teacher: "×¨×•×‘×™"},
                    {course: "×¦'×¤×œ×™×Ÿ ×’-×“", variant: "", teacher: "××•×”×“"}
                ],
                "×’": [
                    {course: "×—×©×‘×•×Ÿ 2", variant: "1", teacher: "××•×“×œ×™×”"},
                    {course: "××¤×’×©×™× ×’'", variant: "1", teacher: "×¨×•×‘×™"},
                    {course: "××¤×’×©×™× ×’'", variant: "2", teacher: "×•×¨×“"},
                    {course: "×¢×‘×¨×™×ª 2", variant: "2", teacher: "××•×¨×Ÿ"}
                ],
                "×“": [
                    {course: "×¤×¨×œ×× ×˜/×©×¢×” ×“××•×§×¨×˜×™×ª", variant: "", teacher: ""}
                ],
                "×”": [
                    {course: "×’×™× ×” ×’-×“", variant: "", teacher: "×××™×”"},
                    {course: "×”×“×‘×¨×™× ×”×¡××•×™×™× ××”×¢×™×Ÿ", variant: "2", teacher: "×•×¨×“"},
                    {course: "×—×©×‘×•×Ÿ 1", variant: "2", teacher: "××•×“×œ×™×”"},
                    {course: "×—×©×‘×•×Ÿ 2", variant: "2", teacher: "×¤××˜××”"},
                    {course: "×¡×¤×¨×™×™×”", variant: "", teacher: "×—×œ×™"},
                    {course: "×¢×‘×¨×™×ª 2", variant: "3", teacher: "××•×¨×Ÿ"}
                ],
                "×•": [
                    {course: "×—×œ×™×œ×™×•×ª", variant: "1", teacher: "×™×•×‘×œ"},
                    {course: "×—×©×‘×•×Ÿ 1", variant: "1", teacher: "××•×“×œ×™×”"},
                    {course: "×—×©×‘×•×Ÿ 2", variant: "3", teacher: "××¡×£"},
                    {course: "××¡×¢ ×¤× ×™××” ×’-×“", variant: "", teacher: "×‘×ª-××œ"},
                    {course: "×× ×’×œ×™×ª 1", variant: "2", teacher: "××™×›×œ"}
                ]
            },
            "09:25-10:10": { // ×©×™×¢×•×¨ 2
                "×": [
                    {course: "××•×× ×•×ª ×’-×“", variant: "1", teacher: "××•×¨×Ÿ"},
                    {course: "×‘×¨×—×•×‘×•×ª ×©×œ× ×•", variant: "1", teacher: "×©×—×¨"},
                    {course: "×”×“×‘×¨×™× ×”×¡××•×™×™× ××”×¢×™×Ÿ", variant: "1", teacher: "×•×¨×“"},
                    {course: "×—×©×‘×•×Ÿ 2", variant: "3", teacher: "××¡×£"},
                    {course: "×¡×‘×™×‘×” ×•×§×™×™××•×ª ×’-×•", variant: "1", teacher: "×¨×•×‘×™"},
                    {course: "×¢×‘×¨×™×ª 1", variant: "2", teacher: "×—×œ×™"}
                ],
                "×‘": [
                    {course: "××¨×‘×¢ ×§×¦×•×•×ª ×ª×‘×œ - ××™×ª×•×œ×•×’×™×•×ª ×•×ª×¨×‘×•×™×•×ª ××”×¢", variant: "", teacher: "××•×”×“"},
                    {course: "×‘×¨×—×•×‘×•×ª ×©×œ× ×•", variant: "2", teacher: "×©×—×¨"},
                    {course: "×—×©×‘×•×Ÿ 2", variant: "3", teacher: "××¡×£"},
                    {course: "××”××˜×‘×— ×‘××”×‘×”", variant: "", teacher: "×”×“×¨"},
                    {course: "×¡×¤×¨×™×™×”", variant: "", teacher: "×—×œ×™"},
                    {course: "×¢×‘×¨×™×ª 2", variant: "1", teacher: "××•×¨×Ÿ"}
                ],
                "×’": [
                    {course: "×©×¢×ª ×—×™×‘×•×¨×™×", variant: "", teacher: ""}
                ],
                "×“": [
                    {course: "×× ×’×œ×™×ª 2", variant: "1", teacher: "××™×›×œ"},
                    {course: "×—×©×‘×•×Ÿ 1", variant: "2", teacher: "××•×“×œ×™×”"},
                    {course: "×—×©×‘×•×Ÿ 2", variant: "2", teacher: "×¤××˜××”"},
                    {course: "××”× ×“×¡×™ ×”×“×•×¨ ×”×‘× ×’-×“", variant: "1", teacher: "×—×™×¦×•× ×™"},
                    {course: "×¢×‘×¨×™×ª 1", variant: "1", teacher: "×¨×•×‘×™"},
                    {course: "×§×•××¤×•×–×™×¦×™×” ×’-×“", variant: "", teacher: "××•×¨×™"}
                ],
                "×”": [
                    {course: "×”×“×‘×¨×™× ×”×¡××•×™×™× ××”×¢×™×Ÿ", variant: "2", teacher: "×•×¨×“"},
                    {course: "×—×©×‘×•×Ÿ 2", variant: "1", teacher: "××•×“×œ×™×”"},
                    {course: "×›× ×™×¡×” ×œ×¢×•×œ× ×”××•×¡×™×§×” ×’-×“", variant: "", teacher: "××•×¨×™"},
                    {course: "×¡×¤×¨×™×™×”", variant: "", teacher: "×—×œ×™"},
                    {course: "×¢×‘×¨×™×ª 2", variant: "2", teacher: "××•×¨×Ÿ"},
                    {course: "×¢×¨×‘×™×ª ×’-×“", variant: "", teacher: "×”×™×™×"}
                ],
                "×•": [
                    {course: "×”×¨×›×‘ ×§×•×œ×™ ×’-×“", variant: "", teacher: "×™×•×‘×œ"},
                    {course: "×›×“×•×¨×’×œ ×‘× ×™× ×’-×“", variant: "", teacher: "× ×•×¢×"},
                    {course: "××¡×‘×™×‘ ×œ×¢×•×œ× ×’-×“", variant: "2", teacher: "××™×™×“×”"},
                    {course: "×ª××˜×¨×•×Ÿ ×’-×“", variant: "", teacher: "×¢×•××¨×™"},
                    {course: "×× ×’×œ×™×ª 1", variant: "1", teacher: "××™×›×œ"}
                ]
            },
            "10:35-11:20": { // ×©×™×¢×•×¨ 3
                "×": [
                    {course: "××•×× ×•×ª ×’-×“", variant: "1", teacher: "××•×¨×Ÿ"},
                    {course: "×‘×¨×—×•×‘×•×ª ×©×œ× ×•", variant: "1", teacher: "×©×—×¨"},
                    {course: "×”×“×‘×¨×™× ×”×¡××•×™×™× ××”×¢×™×Ÿ", variant: "1", teacher: "×•×¨×“"},
                    {course: "×¡×‘×™×‘×” ×•×§×™×™××•×ª ×’-×•", variant: "1", teacher: "×¨×•×‘×™"},
                    {course: "×¢×‘×¨×™×ª 1", variant: "2", teacher: "×—×œ×™"},
                    {course: "×¢×¥ ×•×˜×‘×¢ ×’-×“", variant: "", teacher: "×‘× ×™"}
                ],
                "×‘": [
                    {course: "×× ×’×œ×™×ª 1", variant: "1", teacher: "××™×›×œ"},
                    {course: "×‘×™×˜×‘×•×§×¡ ×’-×“", variant: "", teacher: "××•×¨×™"},
                    {course: "×‘×¨×—×•×‘×•×ª ×©×œ× ×•", variant: "2", teacher: "×©×—×¨"},
                    {course: "×—×©×™×‘×” ×™×¦×™×¨×ª×™×ª ×’-×“", variant: "", teacher: "××•×”×“"},
                    {course: "××”××˜×‘×— ×‘××”×‘×”", variant: "", teacher: "×”×“×¨"},
                    {course: "×¡×¤×¨×™×™×”", variant: "", teacher: "×—×œ×™"},
                    {course: "×¢×‘×¨×™×ª 2", variant: "3", teacher: "××•×¨×Ÿ"}
                ],
                "×’": [
                    {course: "×©×¢×ª ×•×¢×“×•×ª", variant: "", teacher: ""}
                ],
                "×“": [
                    {course: "×× ×’×œ×™×ª 2", variant: "2", teacher: "××™×›×œ"},
                    {course: "×× ×’×œ×™×ª 2", variant: "3", teacher: "×”×œ×œ"},
                    {course: "×—×©×‘×•×Ÿ 2", variant: "1", teacher: "××•×“×œ×™×”"},
                    {course: "××¤×’×©×™× ×’'", variant: "1", teacher: "×¨×•×‘×™"},
                    {course: "××¤×’×©×™× ×’'", variant: "2", teacher: "×•×¨×“"}
                ],
                "×”": [
                    {course: "×”×“×‘×¨×™× ×”×¡××•×™×™× ××”×¢×™×Ÿ", variant: "2", teacher: "×•×¨×“"},
                    {course: "×™×”×“×•×ª ×ª×•×¨×” ×•××” ×©×‘×™× ×™×”× ×’-×“", variant: "", teacher: "× ×—×©×•×Ÿ"},
                    {course: "××¤×’×©×™× ×“'", variant: "1", teacher: "×™×•×‘×œ"},
                    {course: "××¤×’×©×™× ×“'", variant: "2", teacher: "×¤××˜××”"},
                    {course: "××¤×’×©×™× ×“'", variant: "3", teacher: "××•×¨×Ÿ"},
                    {course: "×¡×¤×¨×™×™×”", variant: "", teacher: "×—×œ×™"}
                ],
                "×•": [
                    {course: "×›×“×•×¨×’×œ ×‘× ×•×ª ×’-×•", variant: "", teacher: "× ×•×¢×"},
                    {course: "×ª××˜×¨×•×Ÿ ×’-×“", variant: "", teacher: "×¢×•××¨×™"},
                    {course: "×× ×’×œ×™×ª 2", variant: "2", teacher: "××™×›×œ"},
                    {course: "×—×œ×™×œ×™×•×ª", variant: "2", teacher: "×™×•×‘×œ"},
                    {course: "×—×©×‘×•×Ÿ 2", variant: "1", teacher: "××•×“×œ×™×”"}
                ]
            },
            "11:30-12:15": { // ×©×™×¢×•×¨ 4
                "×": [
                    {course: "P.B.L", variant: "", teacher: "×¨×•×‘×™"},
                    {course: "×‘×¨×—×•×‘×•×ª ×©×œ× ×•", variant: "1", teacher: "×©×—×¨"},
                    {course: "×”×“×‘×¨×™× ×”×¡××•×™×™× ××”×¢×™×Ÿ", variant: "1", teacher: "×•×¨×“"},
                    {course: "×”×”×™×¡×˜×•×¨×™×” ×©×œ ×”×™×œ×“×™× ×•×”×™×œ×“×•×ª ×’-×•", variant: "1", teacher: "×—×œ×™"},
                    {course: "×—×©×‘×•×Ÿ 2", variant: "2", teacher: "×¤××˜××”"}
                ],
                "×‘": [
                    {course: "××•×× ×•×ª ××”×˜×‘×¢ ×’-×“", variant: "", teacher: "×¨×•×‘×™"},
                    {course: "×× ×’×œ×™×ª 1", variant: "2", teacher: "××™×›×œ"},
                    {course: "×”×¡×™×¤×•×¨ ×©×œ ×”×¡×™×¤×•×¨ ×’-×“", variant: "", teacher: "×—×œ×™"},
                    {course: "××¡×‘×™×‘ ×œ×¢×•×œ× ×’-×“", variant: "1", teacher: "××™×™×“×”"},
                    {course: "×¢×‘×¨×™×ª 2", variant: "2", teacher: "××•×¨×Ÿ"},
                    {course: "×ª×¨×‘×•×ª ×™×¤×Ÿ", variant: "", teacher: "××•×”×“"}
                ],
                "×’": [
                    {course: "××¤×’×©×™× ×“'", variant: "1", teacher: "×™×•×‘×œ"},
                    {course: "××¤×’×©×™× ×“'", variant: "2", teacher: "×¤××˜××”"},
                    {course: "××¤×’×©×™× ×“'", variant: "3", teacher: "××•×¨×Ÿ"},
                    {course: "×¢×‘×¨×™×ª 1", variant: "1", teacher: "×¨×•×‘×™"},
                    {course: "×—×©×‘×•×Ÿ 1", variant: "2", teacher: "××•×“×œ×™×”"}
                ],
                "×“": [
                    {course: "×‘×™×•×“× ×¡×” ×’-×“", variant: "", teacher: "×•×¨×“"},
                    {course: "×”×”×™×¡×˜×•×¨×™×” ×©×œ ×”×™×œ×“×™× ×•×”×™×œ×“×•×ª ×’-×•", variant: "2", teacher: "×—×œ×™"},
                    {course: "×›×“×•×¨×’×œ ×‘× ×™× ×’-×“", variant: "", teacher: "× ×•×¢×"},
                    {course: "×¡×‘×™×‘×” ×•×§×™×™××•×ª ×’-×•", variant: "2", teacher: "×¨×•×‘×™"},
                    {course: "×× ×’×œ×™×ª 1", variant: "1", teacher: "××™×›×œ"}
                ],
                "×”": [
                    {course: "×ª××˜×¨×•×Ÿ ×‘×•×‘×•×ª", variant: "", teacher: "×‘× ×™"},
                    {course: "××ª×’×¨×™ ×—×©×™×‘×” ×’-×“", variant: "", teacher: "×”×™×™×"},
                    {course: "×—×©×‘×•×Ÿ 2", variant: "3", teacher: "××¡×£"},
                    {course: "××©×—×§×™ ×¢×‘×¨ ×•×¢×ª×™×“ ×’-×“", variant: "2", teacher: "× ×•×¢×"},
                    {course: "×¡×¤×¨×™×™×”", variant: "", teacher: "×—×œ×™"},
                    {course: "×¢×‘×¨×™×ª 2", variant: "1", teacher: "××•×¨×Ÿ"}
                ],
                "×•": [
                    {course: "×× ×’×œ×™×ª 2", variant: "1", teacher: "××™×›×œ"},
                    {course: "×× ×’×œ×™×ª 2", variant: "3", teacher: "×”×œ×œ"},
                    {course: "×’'×•×“×• ×’-×“", variant: "", teacher: "×’×™×œ×™"},
                    {course: "×—×©×‘×•×Ÿ 1", variant: "2", teacher: "××•×“×œ×™×”"},
                    {course: "×¡×•×“×•×ª ×”×™×§×•× ×’-×“", variant: "", teacher: "××™×™×“×”"}
                ]
            },
            "12:30-13:15": { // ×©×™×¢×•×¨ 5
                "×": [
                    {course: "P.B.L", variant: "", teacher: "×¨×•×‘×™"},
                    {course: "×”×”×™×¡×˜×•×¨×™×” ×©×œ ×”×™×œ×“×™× ×•×”×™×œ×“×•×ª ×’-×•", variant: "1", teacher: "×—×œ×™"},
                    {course: "×—×©×™×‘×” ×¤×™× × ×¡×™×ª ×’-×“", variant: "", teacher: "×¤××˜××”"},
                    {course: "×™×•×¦×¨×™× ×‘×¢×¥ ×’-×“", variant: "1", teacher: "×‘× ×™"},
                    {course: "×œ×¨×§×•×“ ×•×¢×•×“ ×’'-×“'", variant: "", teacher: "×œ×™×œ×š"},
                    {course: "×¢×‘×¨×™×ª 2", variant: "3", teacher: "××•×¨×Ÿ"}
                ],
                "×‘": [
                    {course: "××•×× ×•×ª ××”×˜×‘×¢ ×’-×“", variant: "", teacher: "×¨×•×‘×™"},
                    {course: "×× ×’×œ×™×ª 2", variant: "2", teacher: "××™×›×œ"},
                    {course: "×’×™× ×” ×’-×“", variant: "", teacher: "×××™×”"},
                    {course: "×™×•×¦×¨×™× ×‘×¢×¥ ×’-×“", variant: "2", teacher: "×‘× ×™"},
                    {course: "××©×—×§×™ ×¢×‘×¨ ×•×¢×ª×™×“ ×’-×“", variant: "1", teacher: "× ×•×¢×"},
                    {course: "×¢×‘×¨×™×ª 1", variant: "2", teacher: "×—×œ×™"},
                    {course: "×¦'×¤×œ×™×Ÿ ×•×—×©×™×‘×” ×™×¦×™×¨×ª×™×ª ×”××©×š ×’-×“", variant: "", teacher: "××•×”×“"}
                ],
                "×’": [
                    {course: "×× ×’×œ×™×ª 1", variant: "2", teacher: "××™×›×œ"},
                    {course: "×—×©×‘×•×Ÿ 1", variant: "1", teacher: "××•×“×œ×™×”"},
                    {course: "×—×©×‘×•×Ÿ 2", variant: "2", teacher: "×¤××˜××”"},
                    {course: "×œ××›×•×œ ×‘×¨×™×, ×œ× ×©×•×, ×œ× ×•×¢ ×’-×“", variant: "", teacher: "×”×“×¨"},
                    {course: "×¢×‘×¨×™×ª 2", variant: "1", teacher: "××•×¨×Ÿ"}
                ],
                "×“": [
                    {course: "×”×”×™×¡×˜×•×¨×™×” ×©×œ ×”×™×œ×“×™× ×•×”×™×œ×“×•×ª ×’-×•", variant: "2", teacher: "×—×œ×™"},
                    {course: "×—×©×‘×•×Ÿ 1", variant: "1", teacher: "××•×“×œ×™×”"},
                    {course: "×›×“×•×¨×’×œ ×‘× ×•×ª ×’-×•", variant: "", teacher: "× ×•×¢×"},
                    {course: "××”× ×“×¡×™ ×”×“×•×¨ ×”×‘× ×’-×“", variant: "2", teacher: "×—×™×¦×•× ×™"},
                    {course: "×¡×‘×™×‘×” ×•×§×™×™××•×ª ×’-×•", variant: "2", teacher: "×¨×•×‘×™"}
                ],
                "×”": [
                    {course: "×—×©×™×‘×” ×¤×™× × ×¡×™×ª ×’-×“", variant: "", teacher: "×¤××˜××”"},
                    {course: "×¡×¤×¨×™×™×”", variant: "", teacher: "×—×œ×™"},
                    {course: "×§×•××™×§×¡ ×’-×“", variant: "", teacher: "××•×¨×Ÿ"},
                    {course: "×ª××˜×¨×•×Ÿ ×‘×•×‘×•×ª", variant: "", teacher: "×‘× ×™"},
                    {course: "×”×¨×›×‘ ×§×•×œ×™ ×’-×“", variant: "", teacher: "×™×•×‘×œ"},
                    {course: "×—×©×‘×•×Ÿ 1", variant: "1", teacher: "××•×“×œ×™×”"}
                ],
                "×•": []
            },
            "13:30-14:15": { // ×©×™×¢×•×¨ 6
                "×": [],
                "×‘": [
                    {course: "×× ×’×œ×™×ª ××ª×§×“××™× ×’-×“", variant: "", teacher: "×”×œ×œ"}
                ],
                "×’": [],
                "×“": [
                    {course: "××¨×›×– ×× ×’×œ×™×ª ×’-×“", variant: "", teacher: "××™×›×œ"}
                ],
                "×”": [],
                "×•": []
            }
        };

        let selectedCourses = {};
        let variantMap = {};

        // ×¤×•× ×§×¦×™×” ×œ×™×¦×™×¨×ª ×•×¨×™×× ×˜×™×
        function createVariantMap() {
            variantMap = {};
            let variantCounter = 200;
            let libraryCounter = 1000;
            
            Object.keys(fullScheduleData).forEach(time => {
                Object.keys(fullScheduleData[time]).forEach(day => {
                    fullScheduleData[time][day].forEach(option => {
                        const key = `${option.course}_${option.teacher}`;
                        
                        // ×˜×™×¤×•×œ ××™×•×—×“ ×‘×¡×¤×¨×™×™×”
                        if (option.course === "×¡×¤×¨×™×™×”" || option.course === "×¡×¤×¨×™×”") {
                            option.variant = (libraryCounter++).toString();
                        } else if (!option.variant || option.variant === "") {
                            if (!variantMap[key]) {
                                variantMap[key] = variantCounter++;
                            }
                            option.variant = variantMap[key].toString();
                        }
                    });
                });
            });
        }

        // ×¤×•× ×§×¦×™×” ×œ××¦×™××ª ×›×œ ×”××™×§×•××™× ×©×œ ×©×™×¢×•×¨ ××¡×•×™×
        function findAllCourseLocations(course, variant, teacher) {
            const locations = [];
            const timeSlots = Object.keys(fullScheduleData);
            const days = ['×', '×‘', '×’', '×“', '×”', '×•'];
            
            timeSlots.forEach((time, timeIndex) => {
                days.forEach((day, dayIndex) => {
                    const options = fullScheduleData[time][day] || [];
                    options.forEach(option => {
                        if (option.course === course && 
                            option.variant === variant && 
                            option.teacher === teacher) {
                            locations.push({
                                time: time,
                                day: day,
                                timeIndex: timeIndex,
                                dayIndex: dayIndex
                            });
                        }
                    });
                });
            });
            
            return locations;
        }

        // ×¤×•× ×§×¦×™×” ×œ×‘×“×™×§×ª ×”×ª× ×’×©×•×™×•×ª - ××ª×•×§× ×ª!
        function checkForConflicts(course, variant, teacher, currentTime, currentDay) {
            const conflicts = [];
            
            Object.keys(selectedCourses).forEach(key => {
                const [time, day] = key.split('_');
                const selected = selectedCourses[key];
                
                // ×”×ª× ×’×©×•×ª: ××•×ª×• ××•×¨×” ×‘××•×ª×” ×©×¢×” ×‘×™××™× ×©×•× ×™× (×¨×§ ×× ×”××•×¨×” ×œ× ×¨×™×§)
                if (time === currentTime && day !== currentDay && 
                    selected.teacher === teacher && teacher !== '' && teacher !== undefined) {
                    
                    // ×•×•×“× ×©×–×” ×œ× ××•×ª×• ×©×™×¢×•×¨ ×¢× ××•×ª×• ×•×¨×™×× ×˜ (×©×–×” ×‘×¢×¦× ×¡× ×›×¨×•×Ÿ ×œ×’×™×˜×™××™)
                    if (!(selected.course === course && selected.variant === variant)) {
                        conflicts.push({
                            course: selected.course,
                            teacher: selected.teacher,
                            time: time,
                            day: day,
                            type: 'teacher'
                        });
                    }
                }
            });
            
            return conflicts;
        }

        // ×¤×•× ×§×¦×™×” ×œ×™×¦×™×¨×ª ×”×˜×‘×œ×”
        function createScheduleTable() {
            createVariantMap();
            
            let html = '<table>';
            html += '<thead><tr>';
            html += '<th>×©×¢×”</th>';
            html += '<th>×™×•× ×¨××©×•×Ÿ</th>';
            html += '<th>×™×•× ×©× ×™</th>';
            html += '<th>×™×•× ×©×œ×™×©×™</th>';
            html += '<th>×™×•× ×¨×‘×™×¢×™</th>';
            html += '<th>×™×•× ×—××™×©×™</th>';
            html += '<th>×™×•× ×©×™×©×™</th>';
            html += '</tr></thead>';
            html += '<tbody>';
            
            const dayMapping = {
                '×': 0, '×‘': 1, '×’': 2, '×“': 3, '×”': 4, '×•': 5
            };
            
            Object.keys(fullScheduleData).forEach((time, timeIndex) => {
                html += '<tr>';
                html += `<td class="time-cell">${time}</td>`;
                
                ['×', '×‘', '×’', '×“', '×”', '×•'].forEach(day => {
                    const dayId = dayMapping[day];
                    const options = fullScheduleData[time][day] || [];
                    const cellId = `cell_${timeIndex}_${dayId}`;
                    
                    if (options.length === 0) {
                        html += '<td>-</td>';
                    } else {
                        html += '<td>';
                        html += `<select id="${cellId}" data-time="${time}" data-day="${day}">`;
                        html += '<option value="">-- ×‘×—×¨ ×©×™×¢×•×¨ --</option>';
                        
                        options.forEach(option => {
                            const value = `${option.course}|${option.variant}|${option.teacher}`;
                            const display = option.teacher ? 
                                `${option.course} (${option.variant}) - ${option.teacher}` :
                                `${option.course} (${option.variant})`;
                            html += `<option value="${value}">${display}</option>`;
                        });
                        
                        html += '</select>';
                        html += '</td>';
                    }
                });
                
                html += '</tr>';
            });
            
            html += '</tbody></table>';
            document.getElementById('tableContainer').innerHTML = html;
            
            // ×”×•×¡×£ event listeners
            document.querySelectorAll('select').forEach(select => {
                select.addEventListener('change', handleSelectionChange);
            });
        }

        // ×¤×•× ×§×¦×™×” ×œ×˜×™×¤×•×œ ×‘×‘×—×™×¨×” - ×’×¨×¡×” ×¤×©×•×˜×” ×™×•×ª×¨
        function handleSelectionChange(event) {
            const select = event.target;
            const time = select.getAttribute('data-time');
            const day = select.getAttribute('data-day');
            const value = select.value;
            const key = `${time}_${day}`;
            
            // ×× ×‘×™×˜×œ×• ×‘×—×™×¨×”
            if (!value) {
                // ××—×§ ××ª ×”×‘×—×™×¨×” ×”× ×•×›×—×™×ª
                const wasSelected = selectedCourses[key];
                delete selectedCourses[key];
                select.className = '';
                
                // ×× ×”×™×” ×©×™×¢×•×¨ ×©× ×‘×—×¨, ×‘×“×•×§ ×× ×¦×¨×™×š ×œ× ×§×•×ª ×¡× ×›×¨×•× ×™×
                if (wasSelected) {
                    clearSyncedCourses(wasSelected.course, wasSelected.variant, wasSelected.teacher);
                }
                
                updateStats();
                return;
            }
            
            const [course, variant, teacher] = value.split('|');
            
            // ×‘×“×•×§ ×”×ª× ×’×©×•×™×•×ª
            const conflicts = checkForConflicts(course, variant, teacher, time, day);
            
            if (conflicts.length > 0) {
                let message = `×”×©×™×¢×•×¨ "${course}" ×¢× ${teacher} ××ª× ×’×© ×¢×:\n\n`;
                conflicts.forEach(conflict => {
                    const dayNames = {
                        '×': '×™×•× ×¨××©×•×Ÿ',
                        '×‘': '×™×•× ×©× ×™', 
                        '×’': '×™×•× ×©×œ×™×©×™',
                        '×“': '×™×•× ×¨×‘×™×¢×™',
                        '×”': '×™×•× ×—××™×©×™',
                        '×•': '×™×•× ×©×™×©×™'
                    };
                    message += `â€¢ ${conflict.course} ×¢× ${conflict.teacher} ×‘${dayNames[conflict.day]} ×‘×©×¢×” ${conflict.time}\n`;
                });
                message += `\n×”×× ×‘×¨×¦×•× ×š ×œ×”×—×œ×™×£ ××ª ×”×©×™×¢×•×¨×™× ×”×§×™×™××™× ×‘×©×™×¢×•×¨ ×”×—×“×©?`;
                
                if (!confirm(message)) {
                    select.value = '';
                    return;
                }
                
                // ××—×§ ××ª ×”×©×™×¢×•×¨×™× ×”××ª× ×’×©×™×
                conflicts.forEach(conflict => {
                    const conflictKey = `${conflict.time}_${conflict.day}`;
                    const conflictSelect = document.querySelector(`select[data-time="${conflict.time}"][data-day="${conflict.day}"]`);
                    if (conflictSelect) {
                        conflictSelect.value = '';
                        conflictSelect.className = '';
                        delete selectedCourses[conflictKey];
                    }
                });
            }
            
            // ×©××•×¨ ××ª ×”×‘×—×™×¨×”
            selectedCourses[key] = {
                course, variant, teacher, manual: true
            };
            select.className = 'selected';
            
            // ×¡× ×›×¨×Ÿ ××ª ×›×œ ×”××™×§×•××™× ×©×œ ×”×©×™×¢×•×¨ ×”×–×”
            syncAllCourseLocations(course, variant, teacher, key);
            
            updateStats();
            showDebugInfo();
        }

        // ×¤×•× ×§×¦×™×” ×œ×¡× ×›×¨×•×Ÿ ×›×œ ×”××™×§×•××™× ×©×œ ×©×™×¢×•×¨
        function syncAllCourseLocations(course, variant, teacher, originalKey) {
            const locations = findAllCourseLocations(course, variant, teacher);
            
            console.log(`××¡× ×›×¨×Ÿ ${course} (${variant}) ×¢× ${teacher}`);
            console.log(`× ××¦××• ${locations.length} ××™×§×•××™×:`, locations);
            
            locations.forEach(loc => {
                const locKey = `${loc.time}_${loc.day}`;
                
                // ×“×œ×’ ×¢×œ ×”××™×§×•× ×”××§×•×¨×™
                if (locKey === originalKey) return;
                
                // ×‘×“×•×§ ×”×ª× ×’×©×•×™×•×ª
                const conflicts = checkForConflicts(course, variant, teacher, loc.time, loc.day);
                if (conflicts.length > 0) {
                    console.log(`×“×™×œ×•×’ ×¢×œ ×¡× ×›×¨×•×Ÿ ×‘-${loc.day} ${loc.time} ×‘×’×œ×œ ×”×ª× ×’×©×•×ª`);
                    return;
                }
                
                // ×‘×¦×¢ ×¡× ×›×¨×•×Ÿ
                const cellId = `cell_${loc.timeIndex}_${loc.dayIndex}`;
                const selectElement = document.getElementById(cellId);
                
                if (selectElement) {
                    const value = `${course}|${variant}|${teacher}`;
                    selectElement.value = value;
                    selectElement.className = 'synced';
                    
                    selectedCourses[locKey] = {
                        course, variant, teacher, manual: false
                    };
                    
                    console.log(`×¡×•× ×›×¨×Ÿ: ${loc.day} ${loc.time}`);
                }
            });
        }

        // ×¤×•× ×§×¦×™×” ×œ× ×™×§×•×™ ×¡× ×›×¨×•× ×™× ×©×œ ×©×™×¢×•×¨ ××¡×•×™×
        function clearSyncedCourses(course, variant, teacher) {
            Object.keys(selectedCourses).forEach(key => {
                const selected = selectedCourses[key];
                if (!selected.manual && 
                    selected.course === course && 
                    selected.variant === variant && 
                    selected.teacher === teacher) {
                    
                    const [time, day] = key.split('_');
                    const select = document.querySelector(`select[data-time="${time}"][data-day="${day}"]`);
                    if (select) {
                        select.value = '';
                        select.className = '';
                    }
                    delete selectedCourses[key];
                }
            });
        }

        // ×¤×•× ×§×¦×™×” ×œ×¢×“×›×•×Ÿ ×¡×˜×˜×™×¡×˜×™×§×•×ª
        function updateStats() {
            const manualCount = Object.values(selectedCourses).filter(s => s.manual).length;
            const syncedCount = Object.values(selectedCourses).filter(s => !s.manual).length;
            
            let uniqueCourses = new Set();
            Object.values(selectedCourses).forEach(course => {
                uniqueCourses.add(`${course.course}_${course.variant}`);
            });
            
            document.getElementById('statsContent').innerHTML = `
                <strong>×‘×—×™×¨×•×ª ×™×“× ×™×•×ª:</strong> ${manualCount}<br>
                <strong>×¡×•× ×›×¨× ×• ××•×˜×•××˜×™×ª:</strong> ${syncedCount}<br>
                <strong>×¡×”"×› ××©×‘×¦×•×ª ××œ××•×ª:</strong> ${manualCount + syncedCount}<br>
                <strong>×§×•×¨×¡×™× ×™×™×—×•×“×™×™× ×©× ×‘×—×¨×•:</strong> ${uniqueCourses.size}
            `;
        }

        // ×¤×•× ×§×¦×™×” ×œ×”×¦×’×ª ××™×“×¢ ×“×™×‘××’
        function showDebugInfo() {
            const debugDiv = document.getElementById('debugInfo');
            let html = '<h4>××™×“×¢ ×“×™×‘××’:</h4>';
            html += '<pre>';
            
            Object.keys(selectedCourses).forEach(key => {
                const [time, day] = key.split('_');
                const course = selectedCourses[key];
                html += `${day} ${time}: ${course.course} (${course.variant}) - ${course.teacher} [${course.manual ? '×™×“× ×™' : '×¡× ×›×¨×•×Ÿ'}]\n`;
            });
            
            html += '</pre>';
            debugDiv.innerHTML = html;
        }

        // ×¤×•× ×§×¦×™×” ×œ× ×™×§×•×™ ×‘×—×™×¨×•×ª
        function clearAllSelections() {
            selectedCourses = {};
            document.querySelectorAll('select').forEach(select => {
                select.value = '';
                select.className = '';
            });
            updateStats();
            document.getElementById('debugInfo').innerHTML = '';
        }

        // ×¤×•× ×§×¦×™×” ×œ×™×™×¦×•× ×œ××§×¡×œ
        function exportToExcel() {
            const wb = XLSX.utils.book_new();
            const data = [];
            
            Object.keys(fullScheduleData).forEach(time => {
                const row = { '×©×¢×”': time };
                
                const dayNames = {
                    '×': '×™×•× ×¨××©×•×Ÿ',
                    '×‘': '×™×•× ×©× ×™',
                    '×’': '×™×•× ×©×œ×™×©×™',
                    '×“': '×™×•× ×¨×‘×™×¢×™',
                    '×”': '×™×•× ×—××™×©×™',
                    '×•': '×™×•× ×©×™×©×™'
                };
                
                ['×', '×‘', '×’', '×“', '×”', '×•'].forEach(day => {
                    const key = `${time}_${day}`;
                    if (selectedCourses[key]) {
                        const course = selectedCourses[key];
                        row[dayNames[day]] = course.teacher ? 
                            `${course.course} (${course.variant}) - ${course.teacher}` :
                            `${course.course} (${course.variant})`;
                    } else {
                        row[dayNames[day]] = '';
                    }
                });
                
                data.push(row);
            });
            
            const ws = XLSX.utils.json_to_sheet(data);
            XLSX.utils.book_append_sheet(wb, ws, "××¢×¨×›×ª ×©×¢×•×ª");
            XLSX.writeFile(wb, "××¢×¨×›×ª_×©×¢×•×ª_× ×‘×—×¨×ª.xlsx");
        }

        // ×”×’×“×¨×ª event listeners
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('processBtn').addEventListener('click', function() {
                createScheduleTable();
                document.getElementById('output').style.display = 'block';
                document.getElementById('clearBtn').style.display = 'inline-block';
                document.getElementById('exportBtn').style.display = 'inline-block';
                document.getElementById('debugBtn').style.display = 'inline-block';
                document.querySelector('.legend').style.display = 'flex';
                document.getElementById('stats').style.display = 'block';
                updateStats();
            });
            
            document.getElementById('clearBtn').addEventListener('click', clearAllSelections);
            document.getElementById('exportBtn').addEventListener('click', exportToExcel);
            document.getElementById('debugBtn').addEventListener('click', function() {
                const debugDiv = document.getElementById('debugInfo');
                debugDiv.style.display = debugDiv.style.display === 'none' ? 'block' : 'none';
                showDebugInfo();
            });
            
            console.log("××¢×¨×›×ª ××•×›× ×” - ×’×¨×¡×” ××ª×•×§× ×ª ×¢× ×¡× ×›×¨×•×Ÿ ××©×•×¤×¨!");
        });
    </script>
</body>
</html>
