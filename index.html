"13:30-14:15": { // שיעור 6
                "א": [
                    {course: "Cooking with Yishai", variant: "", teacher: "ישי"},
                    {course: "אנגלית 6", variant: "2", teacher: "קלרין"},
                    {course: "דיבייט", variant: "", teacher: "בנצי"},
                    {course: "הרכב קולי חט\"ב", variant: "", teacher: "אורי"},
                    {course: "מבנה גוף האדם ותפקידו", variant: "1", teacher: "עירית"},
                    {course: "מרכז מלאכה", variant: "", teacher: "ציפי"}
                ],
                "ב": [],
                "ג": [
                    {course: "אומנות עיוני", variant: "", teacher: "הילה"},
                    {course: "אלגברה 3", variant: "1", teacher: "ירון"},
                    {course: "גאומטריה 1", variant: "1", teacher: "יאנה"},
                    {course: "גאומטריה מתחילים", variant: "2", teacher: "טל"},
                    {course: "פודיז", variant: "2", teacher: "סמדר"},
                    {course:<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>מערכת שעות אינטראקטיבית</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .instructions {
            background-color: #e3f2fd;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background-color: #45a049;
        }
        #processBtn34, #processBtn56, #processBtn79 {
            background-color: #2196F3;
        }
        #processBtn34:hover, #processBtn56:hover, #processBtn79:hover {
            background-color: #0976d2;
        }
        #processBtn34.active, #processBtn56.active, #processBtn79.active {
            background-color: #4CAF50;
            font-weight: bold;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        th {
            background-color: #4CAF50;
            color: white;
            font-weight: bold;
        }
        tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        .time-cell {
            background-color: #e8f5e9;
            font-weight: bold;
        }
        #output {
            margin-top: 20px;
            display: none;
        }
        .stats {
            background-color: #fff3e0;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
        select {
            width: 100%;
            padding: 5px;
            font-size: 12px;
            border: 1px solid #ddd;
            border-radius: 3px;
        }
        select option {
            padding: 5px;
        }
        .sync-info {
            background-color: #e8f5e9;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-size: 14px;
        }
        .conflict-warning {
            background-color: #ffebee;
            color: #c62828;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🕐 מערכת שעות אינטראקטיבית</h1>
        
        <div class="instructions">
            <h3>📋 הוראות שימוש:</h3>
            <ol>
                <li>לחץ על "צור מערכת" כדי ליצור את טבלת המערכת</li>
                <li>בחר שיעורים מהתפריטים הנפתחים בכל תא</li>
                <li>שיעורים זהים יסונכרנו אוטומטית (ירוק = מסונכרן, כתום = בחירה ידנית)</li>
                <li>המערכת תזהה התנגשויות ותאפשר לך להחליט</li>
                <li>לחץ על "ייצא לאקסל" כדי להוריד את המערכת הסופית</li>
            </ol>
        </div>

        <div>
            <button id="processBtn34" onclick="createScheduleTable('3-4')">🔄 צור מערכת ג-ד</button>
            <button id="processBtn56" onclick="createScheduleTable('5-6')">🔄 צור מערכת ה-ו</button>
            <button id="processBtn79" onclick="createScheduleTable('7-9')">🔄 צור מערכת ז-ט</button>
            <button onclick="exportToExcel()">📊 ייצא לאקסל</button>
            <button onclick="clearSelections()">🗑️ נקה בחירות</button>
            <button onclick="showDebugInfo()">🔍 הצג מידע דיבאג</button>
        </div>

        <div id="output"></div>
    </div>

    <script>
        // נתונים מתוקנים - כל השיעורים עודכנו
        // מערכת לכיתות ג-ד (ברירת מחדל)
        const scheduleData34 = {
            "08:30-09:20": { // שיעור 1
                "א": [
                    {course: "מפגשים ג'", variant: "1", teacher: "רובי"},
                    {course: "מפגשים ג'", variant: "2", teacher: "ורד"},
                    {course: "מפגשים ד'", variant: "1", teacher: "יובל"},
                    {course: "מפגשים ד'", variant: "2", teacher: "פאטמה"},
                    {course: "מפגשים ד'", variant: "3", teacher: "מורן"},
                    {course: "ספרייה", variant: "", teacher: "חלי"}
                ],
                "ב": [
                    {course: "אנגלית 2", variant: "1", teacher: "מיכל"},
                    {course: "אנגלית 2", variant: "3", teacher: "הלל"},
                    {course: "ברחובות שלנו", variant: "2", teacher: "שחר"},
                    {course: "מהמטבח באהבה", variant: "", teacher: "הדר"},
                    {course: "ספרייה", variant: "", teacher: "חלי"},
                    {course: "עברית 1", variant: "1", teacher: "רובי"},
                    {course: "צ'פלין ג-ד", variant: "", teacher: "אוהד"}
                ],
                "ג": [
                    {course: "חשבון 2", variant: "1", teacher: "אודליה"},
                    {course: "מפגשים ג'", variant: "1", teacher: "רובי"},
                    {course: "מפגשים ג'", variant: "2", teacher: "ורד"},
                    {course: "עברית 2", variant: "2", teacher: "מורן"}
                ],
                "ד": [
                    {course: "פרלמנט/שעה דמוקרטית", variant: "", teacher: ""}
                ],
                "ה": [
                    {course: "גינה ג-ד", variant: "", teacher: "מאיה"},
                    {course: "הדברים הסמויים מהעין", variant: "2", teacher: "ורד"},
                    {course: "חשבון 1", variant: "2", teacher: "אודליה"},
                    {course: "חשבון 2", variant: "2", teacher: "פאטמה"},
                    {course: "ספרייה", variant: "", teacher: "חלי"},
                    {course: "עברית 2", variant: "3", teacher: "מורן"}
                ],
                "ו": [
                    {course: "חליליות", variant: "1", teacher: "יובל"},
                    {course: "חשבון 1", variant: "1", teacher: "אודליה"},
                    {course: "חשבון 2", variant: "3", teacher: "אסף"},
                    {course: "מסע פנימה ג-ד", variant: "", teacher: "בת-אל"},
                    {course: "אנגלית 1", variant: "2", teacher: "מיכל"}
                ]
            },
            "09:25-10:10": { // שיעור 2
                "א": [
                    {course: "אומנות ג-ד", variant: "1", teacher: "מורן"},
                    {course: "ברחובות שלנו", variant: "1", teacher: "שחר"},
                    {course: "הדברים הסמויים מהעין", variant: "1", teacher: "ורד"},
                    {course: "חשבון 2", variant: "3", teacher: "אסף"},
                    {course: "סביבה וקיימות ג-ו", variant: "1", teacher: "רובי"},
                    {course: "עברית 1", variant: "2", teacher: "חלי"}
                ],
                "ב": [
                    {course: "ארבע קצוות תבל - מיתולוגיות ותרבויות מהע", variant: "", teacher: "אוהד"},
                    {course: "ברחובות שלנו", variant: "2", teacher: "שחר"},
                    {course: "חשבון 2", variant: "3", teacher: "אסף"},
                    {course: "מהמטבח באהבה", variant: "", teacher: "הדר"},
                    {course: "ספרייה", variant: "", teacher: "חלי"},
                    {course: "עברית 2", variant: "1", teacher: "מורן"}
                ],
                "ג": [
                    {course: "שעת חיבורים", variant: "", teacher: ""}
                ],
                "ד": [
                    {course: "אנגלית 2", variant: "1", teacher: "מיכל"},
                    {course: "חשבון 1", variant: "2", teacher: "אודליה"},
                    {course: "חשבון 2", variant: "2", teacher: "פאטמה"},
                    {course: "מהנדסי הדור הבא ג-ד", variant: "1", teacher: "חיצוני"},
                    {course: "עברית 1", variant: "1", teacher: "רובי"},
                    {course: "קומפוזיציה ג-ד", variant: "", teacher: "אורי"}
                ],
                "ה": [
                    {course: "הדברים הסמויים מהעין", variant: "2", teacher: "ורד"},
                    {course: "חשבון 2", variant: "1", teacher: "אודליה"},
                    {course: "כניסה לעולם המוסיקה ג-ד", variant: "", teacher: "אורי"},
                    {course: "ספרייה", variant: "", teacher: "חלי"},
                    {course: "עברית 2", variant: "2", teacher: "מורן"},
                    {course: "ערבית ג-ד", variant: "", teacher: "הייא"}
                ],
                "ו": [
                    {course: "הרכב קולי ג-ד", variant: "", teacher: "יובל"},
                    {course: "כדורגל בנים ג-ד", variant: "", teacher: "נועם"},
                    {course: "מסביב לעולם ג-ד", variant: "2", teacher: "איידה"},
                    {course: "תאטרון ג-ד", variant: "", teacher: "עומרי"},
                    {course: "אנגלית 1", variant: "1", teacher: "מיכל"}
                ]
            },
            "10:35-11:20": { // שיעור 3
                "א": [
                    {course: "אומנות ג-ד", variant: "1", teacher: "מורן"},
                    {course: "ברחובות שלנו", variant: "1", teacher: "שחר"},
                    {course: "הדברים הסמויים מהעין", variant: "1", teacher: "ורד"},
                    {course: "סביבה וקיימות ג-ו", variant: "1", teacher: "רובי"},
                    {course: "עברית 1", variant: "2", teacher: "חלי"},
                    {course: "עץ וטבע ג-ד", variant: "", teacher: "בני"}
                ],
                "ב": [
                    {course: "אנגלית 1", variant: "1", teacher: "מיכל"},
                    {course: "ביטבוקס ג-ד", variant: "", teacher: "אורי"},
                    {course: "ברחובות שלנו", variant: "2", teacher: "שחר"},
                    {course: "חשיבה יצירתית ג-ד", variant: "", teacher: "אוהד"},
                    {course: "מהמטבח באהבה", variant: "", teacher: "הדר"},
                    {course: "ספרייה", variant: "", teacher: "חלי"},
                    {course: "עברית 2", variant: "3", teacher: "מורן"}
                ],
                "ג": [
                    {course: "שעת ועדות", variant: "", teacher: ""}
                ],
                "ד": [
                    {course: "אנגלית 2", variant: "2", teacher: "מיכל"},
                    {course: "אנגלית 2", variant: "3", teacher: "הלל"},
                    {course: "חשבון 2", variant: "1", teacher: "אודליה"},
                    {course: "מפגשים ג'", variant: "1", teacher: "רובי"},
                    {course: "מפגשים ג'", variant: "2", teacher: "ורד"}
                ],
                "ה": [
                    {course: "הדברים הסמויים מהעין", variant: "2", teacher: "ורד"},
                    {course: "יהדות תורה ומה שביניהם ג-ד", variant: "", teacher: "נחשון"},
                    {course: "מפגשים ד'", variant: "1", teacher: "יובל"},
                    {course: "מפגשים ד'", variant: "2", teacher: "פאטמה"},
                    {course: "מפגשים ד'", variant: "3", teacher: "מורן"},
                    {course: "ספרייה", variant: "", teacher: "חלי"}
                ],
                "ו": [
                    {course: "כדורגל בנות ג-ו", variant: "", teacher: "נועם"},
                    {course: "תאטרון ג-ד", variant: "", teacher: "עומרי"},
                    {course: "אנגלית 2", variant: "2", teacher: "מיכל"},
                    {course: "חליליות", variant: "2", teacher: "יובל"},
                    {course: "חשבון 2", variant: "1", teacher: "אודליה"}
                ]
            },
            "11:30-12:15": { // שיעור 4
                "א": [
                    {course: "P.B.L", variant: "", teacher: "רובי"},
                    {course: "ברחובות שלנו", variant: "1", teacher: "שחר"},
                    {course: "הדברים הסמויים מהעין", variant: "1", teacher: "ורד"},
                    {course: "ההיסטוריה של הילדים והילדות ג-ו", variant: "1", teacher: "חלי"},
                    {course: "חשבון 2", variant: "2", teacher: "פאטמה"}
                ],
                "ב": [
                    {course: "אומנות מהטבע ג-ד", variant: "", teacher: "רובי"},
                    {course: "אנגלית 1", variant: "2", teacher: "מיכל"},
                    {course: "הסיפור של הסיפור ג-ד", variant: "", teacher: "חלי"},
                    {course: "מסביב לעולם ג-ד", variant: "1", teacher: "איידה"},
                    {course: "עברית 2", variant: "2", teacher: "מורן"},
                    {course: "תרבות יפן", variant: "", teacher: "אוהד"}
                ],
                "ג": [
                    {course: "מפגשים ד'", variant: "1", teacher: "יובל"},
                    {course: "מפגשים ד'", variant: "2", teacher: "פאטמה"},
                    {course: "מפגשים ד'", variant: "3", teacher: "מורן"},
                    {course: "עברית 1", variant: "1", teacher: "רובי"},
                    {course: "חשבון 1", variant: "2", teacher: "אודליה"}
                ],
                "ד": [
                    {course: "ביודנסה ג-ד", variant: "", teacher: "ורד"},
                    {course: "ההיסטוריה של הילדים והילדות ג-ו", variant: "2", teacher: "חלי"},
                    {course: "כדורגל בנים ג-ד", variant: "", teacher: "נועם"},
                    {course: "סביבה וקיימות ג-ו", variant: "2", teacher: "רובי"},
                    {course: "אנגלית 1", variant: "1", teacher: "מיכל"}
                ],
                "ה": [
                    {course: "תאטרון בובות", variant: "", teacher: "בני"},
                    {course: "אתגרי חשיבה ג-ד", variant: "", teacher: "הייא"},
                    {course: "חשבון 2", variant: "3", teacher: "אסף"},
                    {course: "משחקי עבר ועתיד ג-ד", variant: "2", teacher: "נועם"},
                    {course: "ספרייה", variant: "", teacher: "חלי"},
                    {course: "עברית 2", variant: "1", teacher: "מורן"}
                ],
                "ו": [
                    {course: "אנגלית 2", variant: "1", teacher: "מיכל"},
                    {course: "אנגלית 2", variant: "3", teacher: "הלל"},
                    {course: "ג'ודו ג-ד", variant: "", teacher: "גילי"},
                    {course: "חשבון 1", variant: "2", teacher: "אודליה"},
                    {course: "סודות היקום ג-ד", variant: "", teacher: "איידה"}
                ]
            },
            "12:30-13:15": { // שיעור 5
                "א": [
                    {course: "P.B.L", variant: "", teacher: "רובי"},
                    {course: "ההיסטוריה של הילדים והילדות ג-ו", variant: "1", teacher: "חלי"},
                    {course: "חשיבה פיננסית ג-ד", variant: "", teacher: "פאטמה"},
                    {course: "יוצרים בעץ ג-ד", variant: "1", teacher: "בני"},
                    {course: "לרקוד ועוד ג'-ד'", variant: "", teacher: "לילך"},
                    {course: "עברית 2", variant: "3", teacher: "מורן"}
                ],
                "ב": [
                    {course: "אומנות מהטבע ג-ד", variant: "", teacher: "רובי"},
                    {course: "אנגלית 2", variant: "2", teacher: "מיכל"},
                    {course: "גינה ג-ד", variant: "", teacher: "מאיה"},
                    {course: "יוצרים בעץ ג-ד", variant: "2", teacher: "בני"},
                    {course: "משחקי עבר ועתיד ג-ד", variant: "1", teacher: "נועם"},
                    {course: "עברית 1", variant: "2", teacher: "חלי"},
                    {course: "צ'פלין וחשיבה יצירתית המשך ג-ד", variant: "", teacher: "אוהד"}
                ],
                "ג": [
                    {course: "אנגלית 1", variant: "2", teacher: "מיכל"},
                    {course: "חשבון 1", variant: "1", teacher: "אודליה"},
                    {course: "חשבון 2", variant: "2", teacher: "פאטמה"},
                    {course: "לאכול בריא, לנשום, לנוע ג-ד", variant: "", teacher: "הדר"},
                    {course: "עברית 2", variant: "1", teacher: "מורן"}
                ],
                "ד": [
                    {course: "ההיסטוריה של הילדים והילדות ג-ו", variant: "2", teacher: "חלי"},
                    {course: "חשבון 1", variant: "1", teacher: "אודליה"},
                    {course: "כדורגל בנות ג-ו", variant: "", teacher: "נועם"},
                    {course: "מהנדסי הדור הבא ג-ד", variant: "2", teacher: "חיצוני"},
                    {course: "סביבה וקיימות ג-ו", variant: "2", teacher: "רובי"}
                ],
                "ה": [
                    {course: "חשיבה פיננסית ג-ד", variant: "", teacher: "פאטמה"},
                    {course: "ספרייה", variant: "", teacher: "חלי"},
                    {course: "קומיקס ג-ד", variant: "", teacher: "מורן"},
                    {course: "תאטרון בובות", variant: "", teacher: "בני"},
                    {course: "הרכב קולי ג-ד", variant: "", teacher: "יובל"},
                    {course: "חשבון 1", variant: "1", teacher: "אודליה"}
                ],
                "ו": []
            },
            "13:30-14:15": { // שיעור 6
                "א": [],
                "ב": [
                    {course: "אנגלית מתקדמים ג-ד", variant: "", teacher: "הלל"}
                ],
                "ג": [],
                "ד": [
                    {course: "מרכז אנגלית ג-ד", variant: "", teacher: "מיכל"}
                ],
                "ה": [],
                "ו": []
            }
        };

        // מערכת לכיתות ה-ו (יתווסף בהמשך)
        const scheduleData56 = {
            "08:30-09:20": { // שיעור 1
                "א": [
                    {course: "גינה ה-ו", variant: "1", teacher: "מאיה"},
                    {course: "חשבון 3", variant: "1", teacher: "אסף"},
                    {course: "יהדות תורה ומה שביניהם ה-ו", variant: "", teacher: "נחשון"},
                    {course: "ספרייה", variant: "", teacher: "חלי"},
                    {course: "עץ וטבע ה-ו", variant: "", teacher: "בני"},
                    {course: "קומיקס ה-ו", variant: "", teacher: "עומרי"}
                ],
                "ב": [
                    {course: "מפגשים ה'", variant: "1", teacher: "עומרי"},
                    {course: "מפגשים ה'", variant: "1", teacher: "מאיה"},
                    {course: "מפגשים ו'", variant: "1", teacher: "מירית"},
                    {course: "מפגשים ו'", variant: "1", teacher: "נחשון"},
                    {course: "ספרייה", variant: "", teacher: "חלי"}
                ],
                "ג": [
                    {course: "חשבון 4", variant: "1", teacher: "פאטמה"},
                    {course: "חשבון 4", variant: "2", teacher: "טל"},
                    {course: "עברית 3", variant: "1", teacher: "גילי"},
                    {course: "עברית 3", variant: "2", teacher: "מירית"}
                ],
                "ד": [
                    {course: "פרלמנט/שעה דמוקרטית", variant: "", teacher: ""}
                ],
                "ה": [
                    {course: "חשבון 3", variant: "2", teacher: "אסף"},
                    {course: "מפגשים ו'", variant: "1", teacher: "נחשון"},
                    {course: "מפגשים ו'", variant: "1", teacher: "מירית"},
                    {course: "ספרייה", variant: "", teacher: "חלי"},
                    {course: "עברית 3", variant: "1", teacher: "גילי"}
                ],
                "ו": [
                    {course: "אנגלית 4", variant: "1", teacher: "הלל"},
                    {course: "מסביב לעולם ה-ו", variant: "2", teacher: "איידה"},
                    {course: "עברית 4", variant: "2", teacher: "מירית"},
                    {course: "תלת-מימד ה-ו", variant: "", teacher: "עומרי"}
                ]
            },
            "09:25-10:10": { // שיעור 2
                "א": [
                    {course: "חשיבה פיננסית ה-ו", variant: "1", teacher: "פאטמה"},
                    {course: "מפגשים ה'", variant: "1", teacher: "מאיה"},
                    {course: "מפגשים ה'", variant: "1", teacher: "עומרי"},
                    {course: "סביבה וקיימות ג-ו", variant: "1", teacher: "רובי"}
                ],
                "ב": [
                    {course: "אנגלית 3", variant: "1", teacher: "הלל"},
                    {course: "מסביב לעולם ה-ו", variant: "1", teacher: "איידה"},
                    {course: "ספרייה", variant: "", teacher: "חלי"},
                    {course: "עברית 4", variant: "2", teacher: "מירית"},
                    {course: "ערבית ה-ו", variant: "", teacher: "הייא"},
                    {course: "קצב הלב", variant: "1", teacher: "אורי"}
                ],
                "ג": [
                    {course: "שעת חיבורים", variant: "", teacher: ""}
                ],
                "ד": [
                    {course: "אנגלית 3", variant: "2", teacher: "הלל"},
                    {course: "לא לפי הספר ה-ו", variant: "", teacher: "חלי"},
                    {course: "מהמטבח באהבה ה-ו", variant: "2", teacher: "הדר"},
                    {course: "עברית 4", variant: "1", teacher: "מירית"},
                    {course: "עימותים בחברה הישראלית", variant: "", teacher: "אוהד"},
                    {course: "תאטרון ה-ו", variant: "1", teacher: "בני"},
                    {course: "תאטרון ה-ו", variant: "1", teacher: "עומרי"}
                ],
                "ה": [
                    {course: "אנגלית 4", variant: "2", teacher: "ישי"},
                    {course: "חשבון 3", variant: "1", teacher: "אסף"},
                    {course: "חשבון 4", variant: "1", teacher: "פאטמה"},
                    {course: "ספרייה", variant: "", teacher: "חלי"},
                    {course: "עברית 3", variant: "2", teacher: "מירית"}
                ],
                "ו": [
                    {course: "אנגלית 3", variant: "1", teacher: "הלל"},
                    {course: "חשבון 3", variant: "2", teacher: "אסף"},
                    {course: "חשבון 4", variant: "2", teacher: "טל"},
                    {course: "עברית 4", variant: "1", teacher: "מירית"}
                ]
            },
            "10:35-11:20": { // שיעור 3
                "א": [
                    {course: "הלחנה וכתיבה ה-ו", variant: "", teacher: "אורי"},
                    {course: "חשבון 4", variant: "1", teacher: "פאטמה"},
                    {course: "מדעים בטבע ה-ו", variant: "", teacher: "מאיה"},
                    {course: "מהמטבח באהבה ה-ו", variant: "1", teacher: "הדר"},
                    {course: "סביבה וקיימות ג-ו", variant: "1", teacher: "רובי"}
                ],
                "ב": [
                    {course: "אנגלית 3", variant: "2", teacher: "הלל"},
                    {course: "אנגלית 4", variant: "2", teacher: "ישי"},
                    {course: "חשבון 3", variant: "1", teacher: "אסף"},
                    {course: "ספרייה", variant: "", teacher: "חלי"},
                    {course: "עברית 4", variant: "1", teacher: "מירית"}
                ],
                "ג": [
                    {course: "שעת ועדות", variant: "", teacher: ""}
                ],
                "ד": [
                    {course: "חוקרים את אמריקה ה-ו", variant: "1", teacher: "איידה"},
                    {course: "חשבון 4", variant: "1", teacher: "פאטמה"},
                    {course: "לא לפי הספר ה-ו", variant: "", teacher: "חלי"},
                    {course: "מהמטבח באהבה ה-ו", variant: "2", teacher: "הדר"},
                    {course: "סיור מוחי ה-ו", variant: "", teacher: "אוהד"},
                    {course: "עברית 3", variant: "2", teacher: "מירית"},
                    {course: "תאטרון ה-ו", variant: "1", teacher: "עומרי"},
                    {course: "תאטרון ה-ו", variant: "1", teacher: "בני"}
                ],
                "ה": [
                    {course: "גינה ה-ו", variant: "2", teacher: "מאיה"},
                    {course: "הרכב קולי ה-ו", variant: "", teacher: "אורי"},
                    {course: "נפלאות האדם ה-ו", variant: "", teacher: "אודליה"},
                    {course: "ספרייה", variant: "", teacher: "חלי"},
                    {course: "עברית 4", variant: "2", teacher: "מירית"}
                ],
                "ו": [
                    {course: "אנגלית 3", variant: "2", teacher: "הלל"},
                    {course: "חשבון 3", variant: "1", teacher: "אסף"},
                    {course: "חשבון 4", variant: "2", teacher: "טל"},
                    {course: "כדורגל בנות ג-ו", variant: "", teacher: "נועם"}
                ]
            },
            "11:30-12:15": { // שיעור 4
                "א": [
                    {course: "ברוח יוצרת ה-ו", variant: "", teacher: "הילה"},
                    {course: "ההיסטוריה של הילדים והילדות ג-ו", variant: "1", teacher: "חלי"},
                    {course: "כלבנות ה-ו", variant: "1", teacher: "מעין"},
                    {course: "מדעים בטבע ה-ו", variant: "", teacher: "מאיה"},
                    {course: "מהמטבח באהבה ה-ו", variant: "1", teacher: "הדר"}
                ],
                "ב": [
                    {course: "אנגלית 4", variant: "1", teacher: "הלל"},
                    {course: "ג'ודו והגנה עצמית ה-ו", variant: "", teacher: "נחשון"},
                    {course: "דוברי אנגלית ה-ו", variant: "", teacher: "ישי"},
                    {course: "חשבון 3", variant: "2", teacher: "אסף"},
                    {course: "יוצרים בעץ ה-ו", variant: "", teacher: "בני"}
                ],
                "ג": [
                    {course: "מפגשים ה'", variant: "1", teacher: "מאיה"},
                    {course: "מפגשים ה'", variant: "1", teacher: "עומרי"},
                    {course: "מפגשים ו'", variant: "1", teacher: "מירית"},
                    {course: "מפגשים ו'", variant: "1", teacher: "נחשון"}
                ],
                "ד": [
                    {course: "אנגלית 4", variant: "1", teacher: "הלל"},
                    {course: "ההיסטוריה של הילדים והילדות ג-ו", variant: "2", teacher: "חלי"},
                    {course: "חוקרים את אמריקה ה-ו", variant: "2", teacher: "איידה"},
                    {course: "כניסה לעולם המוסיקה ה-ו", variant: "", teacher: "אורי"},
                    {course: "מהמטבח באהבה ה-ו", variant: "2", teacher: "הדר"},
                    {course: "סביבה וקיימות ג-ו", variant: "2", teacher: "רובי"},
                    {course: "תאטרון ה-ו", variant: "2", teacher: "עומרי"},
                    {course: "תאטרון ה-ו", variant: "2", teacher: "בני"}
                ],
                "ה": [
                    {course: "גינה ה-ו", variant: "1", teacher: "מאיה"},
                    {course: "חשיבה פיננסית ה-ו", variant: "2", teacher: "פאטמה"},
                    {course: "כניסה לעולם המוסיקה ה-ו", variant: "", teacher: "אורי"},
                    {course: "מאכלי רחוב ומסביב לעולם", variant: "", teacher: "ורד"},
                    {course: "ספרייה", variant: "", teacher: "חלי"},
                    {course: "עברית 4", variant: "1", teacher: "מירית"}
                ],
                "ו": [
                    {course: "ההיסטוריה של יוון ורומא", variant: "", teacher: "יובל"},
                    {course: "לרקוד ועוד ה-ו", variant: "", teacher: "לילך"},
                    {course: "מסע פנימה ה-ו", variant: "", teacher: "בת-אל"},
                    {course: "פינת חי ה-ו", variant: "", teacher: "אסף"}
                ]
            },
            "12:30-13:15": { // שיעור 5
                "א": [
                    {course: "ברוח יוצרת ה-ו", variant: "", teacher: "הילה"},
                    {course: "ההיסטוריה של הילדים והילדות ג-ו", variant: "1", teacher: "חלי"},
                    {course: "כלבנות ה-ו", variant: "2", teacher: "מעין"},
                    {course: "מדעים בטבע ה-ו", variant: "", teacher: "מאיה"},
                    {course: "מהמטבח באהבה ה-ו", variant: "1", teacher: "הדר"}
                ],
                "ב": [
                    {course: "הקסם של הבינה ה-ח", variant: "", teacher: "פאטמה"},
                    {course: "הרכב קולי ה-ו", variant: "", teacher: "אורי"},
                    {course: "חשבון 3", variant: "2", teacher: "אסף"},
                    {course: "חשבון 4", variant: "2", teacher: "טל"},
                    {course: "מרכז אנגלית ה-ו", variant: "", teacher: "הלל"},
                    {course: "עברית 3", variant: "1", teacher: "גילי"}
                ],
                "ג": [
                    {course: "גינה ה-ו", variant: "2", teacher: "מאיה"},
                    {course: "ההוביט והעולם הדמיוני של טולקין", variant: "", teacher: "יובל"},
                    {course: "כדורשת ה-ו", variant: "", teacher: "איידה"},
                    {course: "עברית 4", variant: "2", teacher: "מירית"},
                    {course: "קצב הלב", variant: "2", teacher: "אורי"}
                ],
                "ד": [
                    {course: "אנגלית 3", variant: "1", teacher: "הלל"},
                    {course: "אנגלית 4", variant: "2", teacher: "ישי"},
                    {course: "ההיסטוריה של הילדים והילדות ג-ו", variant: "2", teacher: "חלי"},
                    {course: "כדורגל בנות ג-ו", variant: "", teacher: "נועם"},
                    {course: "סביבה וקיימות ג-ו", variant: "2", teacher: "רובי"},
                    {course: "סיפורים מהבגצ ה-ו", variant: "", teacher: "אוהד"},
                    {course: "תאטרון ה-ו", variant: "2", teacher: "עומרי"},
                    {course: "תאטרון ה-ו", variant: "2", teacher: "בני"}
                ],
                "ה": [
                    {course: "ביטבוקס ה-ו", variant: "", teacher: "אורי"},
                    {course: "דמויות היסטוריות", variant: "", teacher: "אורי"},
                    {course: "כדורגל בנים ה-ו", variant: "", teacher: "נועם"},
                    {course: "מאכלי רחוב ומסביב לעולם", variant: "", teacher: "ורד"},
                    {course: "ספרייה", variant: "", teacher: "חלי"}
                ],
                "ו": []
            },
            "13:30-14:15": { // שיעור 6
                "א": [],
                "ב": [],
                "ג": [],
                "ד": [
                    {course: "דוברי אנגלית ה-ו", variant: "", teacher: "ישי"},
                    {course: "מהנדסי הדור הבא ה-ו", variant: "", teacher: "חיצוני"}
                ],
                "ה": [
                    {course: "בנות מצווה", variant: "", teacher: "מירית"},
                    {course: "מאכלי רחוב ומסביב לעולם", variant: "", teacher: "ורד"}
                ],
                "ו": []
            }
        };

        // מערכת לכיתות ז-ט 
        const scheduleData79 = {
            "08:30-09:20": { // שיעור 1
                "א": [
                    {course: "מפגש שכבת ז'", variant: "", teacher: "הילה ונתנאל"},
                    {course: "מפגש שכבת ח'", variant: "", teacher: "אורי ושי-לי"},
                    {course: "מפגש שכבת ט'", variant: "", teacher: "ענת וישי"}
                ],
                "ב": [
                    {course: "אלגברה 2", variant: "1", teacher: "טל"},
                    {course: "אלגברה 3", variant: "2", teacher: "ירון"},
                    {course: "אנגלית 5", variant: "1", teacher: "נתנאל"},
                    {course: "אנגלית 6", variant: "2", teacher: "קלרין"},
                    {course: "אנגלית 7", variant: "1", teacher: "ישי"},
                    {course: "עברית 5", variant: "2", teacher: "ציפי"},
                    {course: "עץ וטבע חט\"ב תיכון", variant: "1", teacher: "בני"}
                ],
                "ג": [
                    {course: "אלגברה 1", variant: "2", teacher: "יאנה"},
                    {course: "אנגלית 6", variant: "1", teacher: "קלרין"},
                    {course: "אנגלית 7", variant: "2", teacher: "ישי"},
                    {course: "סדנת עיבוד עץ חט\"ב-תיכון", variant: "", teacher: "בני (סדנת נגרות)"},
                    {course: "עברית 5", variant: "1", teacher: "ציפי"},
                    {course: "עברית 6", variant: "2", teacher: "גילי"},
                    {course: "עברית 7", variant: "1", teacher: "ענת"}
                ],
                "ד": [
                    {course: "פרלמנט, שעה דמוקרטית", variant: "", teacher: ""}
                ],
                "ה": [
                    {course: "אנגלית 5", variant: "2", teacher: "נתנאל"},
                    {course: "גאומטריה 1", variant: "1", teacher: "יאנה"},
                    {course: "הלך נגד הרוח", variant: "", teacher: "אילנית"},
                    {course: "מהו תאטרון", variant: "1", teacher: "בני"},
                    {course: "מהפכות בהיסטוריה", variant: "", teacher: "שי-לי"},
                    {course: "עברית 7", variant: "2", teacher: "ענת"},
                    {course: "פילאטיס חט\"ב", variant: "1", teacher: "עירית"}
                ],
                "ו": []
            },
            "09:25-10:10": { // שיעור 2
                "א": [
                    {course: "אלגברה 1", variant: "2", teacher: "יאנה"},
                    {course: "אנגלית 6", variant: "1", teacher: "קלרין"},
                    {course: "אנגלית 7", variant: "1", teacher: "ישי"},
                    {course: "עברית 5", variant: "1", teacher: "ציפי"},
                    {course: "עברית 6", variant: "2", teacher: "גילי"},
                    {course: "עברית 7", variant: "2", teacher: "ענת"}
                ],
                "ב": [
                    {course: "אלגברה 1", variant: "1", teacher: "יאנה"},
                    {course: "אלגברה 2", variant: "2", teacher: "טל"},
                    {course: "אנגלית למתקדמים", variant: "", teacher: "קלרין"},
                    {course: "יזמות כלבנית", variant: "", teacher: "מעין"},
                    {course: "מנהיגות בתנ\"ך", variant: "", teacher: "אילנית"},
                    {course: "עץ וטבע חט\"ב תיכון", variant: "1", teacher: "בני"},
                    {course: "פודיז", variant: "1", teacher: "סמדר"},
                    {course: "פודיז", variant: "1", teacher: "אנה"}
                ],
                "ג": [
                    {course: "מפגש חיבורים", variant: "", teacher: ""}
                ],
                "ד": [
                    {course: "אומנות", variant: "1", teacher: "סמדר"},
                    {course: "אומנות", variant: "1", teacher: "שרון"},
                    {course: "אלגברה 2", variant: "1", teacher: "טל"},
                    {course: "אנגלית 7", variant: "2", teacher: "ישי"},
                    {course: "גאומטריה 2", variant: "1", teacher: "יאנה"},
                    {course: "יסודות הכימיה חט\"ב", variant: "", teacher: "אור"},
                    {course: "עץ וטבע חט\"ב תיכון", variant: "2", teacher: "בני"}
                ],
                "ה": [
                    {course: "אלגברה 1", variant: "2", teacher: "יאנה"},
                    {course: "אלגברה 3", variant: "1", teacher: "ירון"},
                    {course: "חנ\"ג בנות חט\"ב", variant: "1", teacher: "עירית"},
                    {course: "חנ\"ג בנים חט\"ב", variant: "1", teacher: "רוי"},
                    {course: "יזמות ועשייה", variant: "", teacher: "אורי"},
                    {course: "מהו תאטרון", variant: "1", teacher: "בני"}
                ],
                "ו": []
            },
            "10:35-11:20": { // שיעור 3
                "א": [
                    {course: "דילמות", variant: "1", teacher: "טל"},
                    {course: "חינוך פיננסי חט\"ב", variant: "", teacher: "בנצי"},
                    {course: "חנ\"ג בנות חט\"ב", variant: "1", teacher: "עירית"},
                    {course: "חנ\"ג בנים חט\"ב", variant: "1", teacher: "רוי"},
                    {course: "עברית 5", variant: "2", teacher: "ציפי"},
                    {course: "עברית 6", variant: "1", teacher: "גילי"},
                    {course: "עברית 7", variant: "1", teacher: "ענת"},
                    {course: "צילום", variant: "1", teacher: "סמדר"},
                    {course: "צילום", variant: "1", teacher: "שרון"}
                ],
                "ב": [
                    {course: "Space-Up", variant: "", teacher: "טל"},
                    {course: "איך בונים מחשב?", variant: "", teacher: "אלחנן"},
                    {course: "גמולוגיה", variant: "", teacher: "ציפי"},
                    {course: "דמוקרטיות מסביב לעולם", variant: "", teacher: "ניר"},
                    {course: "יזמות כלבנית", variant: "", teacher: "מעין"},
                    {course: "מבוא לחברה הישראלית", variant: "", teacher: "טל"},
                    {course: "פודיז", variant: "1", teacher: "סמדר"}
                ],
                "ג": [
                    {course: "שעת ועדות", variant: "", teacher: ""}
                ],
                "ד": [
                    {course: "Space-Up", variant: "", teacher: "טל"},
                    {course: "אומנות", variant: "2", teacher: "שרון"},
                    {course: "אומנות", variant: "2", teacher: "סמדר"},
                    {course: "ארכאולוגיה", variant: "", teacher: "שי-לי"},
                    {course: "כלביה חט\"ב", variant: "", teacher: "מעין"},
                    {course: "עברית 5", variant: "1", teacher: "ציפי"},
                    {course: "עברית 6", variant: "2", teacher: "גילי"}
                ],
                "ה": [
                    {course: "מפגש שכבת ז'", variant: "", teacher: "הילה ונתנאל"},
                    {course: "מפגש שכבת ח'", variant: "", teacher: "אורי ושי-לי"},
                    {course: "מפגש שכבת ט'", variant: "", teacher: "ענת וישי"}
                ],
                "ו": []
            },
            "11:30-12:15": { // שיעור 4
                "א": [
                    {course: "אנגלית 7", variant: "2", teacher: "ישי"},
                    {course: "הוביט והעולם הדמיוני של טולקין", variant: "", teacher: "יובל"},
                    {course: "חינוך פיננסי חט\"ב", variant: "", teacher: "בנצי"},
                    {course: "חנ\"ג בנות חט\"ב", variant: "2", teacher: "עירית"},
                    {course: "ילדים מלמדים ילדים", variant: "", teacher: "אורי"},
                    {course: "כדורעף בנים", variant: "", teacher: "רוי"},
                    {course: "קולנוע חט\"ב", variant: "", teacher: "עומרי"}
                ],
                "ב": [
                    {course: "איך בונים מחשב?", variant: "", teacher: "אלחנן"},
                    {course: "הלך נגד הרוח", variant: "", teacher: "אילנית"},
                    {course: "כדורגל בנים חט\"ב", variant: "", teacher: "נועם"},
                    {course: "מהפכות בהיסטוריה", variant: "", teacher: "שי-לי"},
                    {course: "עברית 6", variant: "1", teacher: "גילי"},
                    {course: "פיסול", variant: "", teacher: "הילה"}
                ],
                "ג": [
                    {course: "אלגברה 1", variant: "1", teacher: "יאנה"},
                    {course: "אלגברה 2", variant: "2", teacher: "טל"},
                    {course: "אנגלית למתקדמים", variant: "", teacher: "קלרין"},
                    {course: "ארכאולוגיה", variant: "", teacher: "שי-לי"},
                    {course: "מבוא לחברה הישראלית", variant: "", teacher: "טל"},
                    {course: "פילוסופיה חט\"ב", variant: "", teacher: "ציפי"}
                ],
                "ד": [
                    {course: "איטלקית", variant: "", teacher: "ציפי"},
                    {course: "אנגלית 6", variant: "2", teacher: "קלרין"},
                    {course: "ביולוגיה לחט\"ב", variant: "", teacher: "אור"},
                    {course: "בין שלמות למציאות", variant: "", teacher: "עדי"},
                    {course: "דמוקרטיות מסביב לעולם", variant: "", teacher: "ניר"},
                    {course: "סיפור אחד", variant: "", teacher: "טל"},
                    {course: "פודיז", variant: "3", teacher: "אנה"}
                ],
                "ה": [
                    {course: "מפגש שכבת ז'", variant: "", teacher: "הילה ונתנאל"},
                    {course: "מפגש שכבת ח'", variant: "", teacher: "אורי ושי-לי"},
                    {course: "מפגש שכבת ט'", variant: "", teacher: "ענת וישי"}
                ],
                "ו": []
            },
            "12:30-13:15": { // שיעור 5
                "א": [
                    {course: "Cooking with Yishai", variant: "", teacher: "ישי"},
                    {course: "אנגלית 5", variant: "1", teacher: "נתנאל"},
                    {course: "גאומטריה 2", variant: "2", teacher: "יאנה"},
                    {course: "דיבייט", variant: "", teacher: "בנצי"},
                    {course: "ההוביט והעולם הדמיוני של טולקין", variant: "", teacher: "יובל"},
                    {course: "חנ\"ג בנים חט\"ב", variant: "2", teacher: "רוי"},
                    {course: "צילום", variant: "2", teacher: "שרון"},
                    {course: "צילום", variant: "2", teacher: "סמדר"},
                    {course: "קולנוע חט\"ב", variant: "", teacher: "עומרי"}
                ],
                "ב": [
                    {course: "איטלקית", variant: "", teacher: "ציפי"},
                    {course: "איך בונים מחשב?", variant: "", teacher: "אלחנן"},
                    {course: "אנגלית 5", variant: "2", teacher: "נתנאל"},
                    {course: "הקסם של הבינה ה-ח", variant: "", teacher: "פאטמה"},
                    {course: "פודיז", variant: "2", teacher: "סמדר"},
                    {course: "פודיז", variant: "2", teacher: "אנה"},
                    {course: "פיסול", variant: "", teacher: "הילה"},
                    {course: "קומיקס חט\"ב", variant: "1", teacher: "עומרי"}
                ],
                "ג": [
                    {course: "אלגברה 2", variant: "1", teacher: "טל"},
                    {course: "אלגברה 3", variant: "1", teacher: "ירון"},
                    {course: "אנגלית 5", variant: "2", teacher: "נתנאל"},
                    {course: "בטבע שלי", variant: "1", teacher: "חן"},
                    {course: "דילמות", variant: "2", teacher: "טל"},
                    {course: "עברית 7", variant: "2", teacher: "ענת"},
                    {course: "תולדות הרוק והפופ", variant: "", teacher: "אורי"}
                ],
                "ד": [
                    {course: "אותיות השפה הערבית", variant: "", teacher: "הייא"},
                    {course: "אלגברה 2", variant: "2", teacher: "טל"},
                    {course: "גאומטריה מתחילים", variant: "1", teacher: "יאנה"},
                    {course: "גמולוגיה", variant: "", teacher: "ציפי"},
                    {course: "הגנה עצמית חט\"ב", variant: "1", teacher: "נחשון"},
                    {course: "כימיה למתקדמים ח-ט", variant: "", teacher: "אור"},
                    {course: "ספרדית חט\"ב", variant: "", teacher: "קלרין"},
                    {course: "פודיז", variant: "3", teacher: "אנה"}
                ],
                "ה": [
                    {course: "אלגברה 1", variant: "1", teacher: "יאנה"},
                    {course: "אנגלית 7", variant: "1", teacher: "ישי"},
                    {course: "הגנה עצמית חט\"ב", variant: "2", teacher: "נחשון"},
                    {course: "מבנה גוף האדם ותפקידו", variant: "2", teacher: "עירית"},
                    {course: "מנהיגות בתנ\"ך", variant: "", teacher: "אילנית"},
                    {course: "פינת חי חט\"ב", variant: "", teacher: "אסף"},
                    {course: "ציור חט\"ב", variant: "", teacher: "הילה"}
                ],
                "ו": []
            },
            "13:30-14:15": { // שיעור 6
                "א": [
                    {course: "Cooking with Yishai", variant: "", teacher: "ישי"},
                    {course: "אנגלית 6", variant: "2", teacher: "קלרין"},
                    {course: "דיבייט", variant: "", teacher: "בנצי"},
                    {course: "הרכב קולי חט\"ב", variant: "", teacher: "אורי"},
                    {course: "מבנה גוף האדם ותפקידו", variant: "1", teacher: "עירית"},
                    {course: "מרכז מלאכה", variant: "", teacher: "ציפי"}
                ],
                "ב": [
                    {course: "אומנות עיוני", variant: "", teacher: "הילה"},
                    {course: "אלגברה 3", variant: "1", teacher: "ירון"},
                    {course: "גאומטריה 1", variant: "1", teacher: "יאנה"},
                    {course: "גאומטריה מתחילים", variant: "2", teacher: "טל"},
                    {course: "פודיז", variant: "2", teacher: "סמדר"},
                    {course: "פודיז", variant: "2", teacher: "אנה"},
                    {course: "קומיקס חט\"ב", variant: "2", teacher: "עומרי"}
                ],
                "ג": [],
                "ד": [
                    {course: "אנגלית 5", variant: "1", teacher: "נתנאל"},
                    {course: "גאומטריה 1", variant: "2", teacher: "טל"},
                    {course: "גאומטריה 2", variant: "2", teacher: "יאנה"},
                    {course: "עברית 5", variant: "2", teacher: "ציפי"},
                    {course: "עברית 6", variant: "1", teacher: "גילי"},
                    {course: "עברית 7", variant: "1", teacher: "ענת"}
                ],
                "ה": [
                    {course: "אלגברה 3", variant: "2", teacher: "ירון"},
                    {course: "בטבע שלי", variant: "2", teacher: "חן"},
                    {course: "חנ\"ג בנות חט\"ב", variant: "2", teacher: "עירית"},
                    {course: "חנ\"ג בנים חט\"ב", variant: "2", teacher: "רוי"},
                    {course: "מהו תאטרון", variant: "2", teacher: "בני"},
                    {course: "ערבית מדוברת", variant: "", teacher: "הייא"},
                    {course: "ציור חט\"ב", variant: "", teacher: "הילה"}
                ],
                "ו": []
            },
            "14:15-15:00": { // שיעור 7
                "א": [
                    {course: "Cooking with Yishai", variant: "", teacher: "ישי"},
                    {course: "מרכז מלאכה", variant: "", teacher: "ציפי"}
                ],
                "ב": [
                    {course: "אומנות עיוני", variant: "", teacher: "הילה"},
                    {course: "גאומטריה 1", variant: "2", teacher: "טל"},
                    {course: "גאומטריה 2", variant: "1", teacher: "יאנה"}
                ],
                "ג": [],
                "ד": [
                    {course: "אנגלית 6", variant: "1", teacher: "קלרין"},
                    {course: "מהנדסי הדור הבא חט\"ב", variant: "", teacher: "חיצוני"},
                    {course: "סאונד והפקה", variant: "", teacher: "אורי"},
                    {course: "ספרות חט\"ב", variant: "", teacher: "ציפי"}
                ],
                "ה": [
                    {course: "אלגברה 3", variant: "2", teacher: "ירון"},
                    {course: "כדורעף בנים", variant: "", teacher: "רוי"},
                    {course: "מהו תאטרון", variant: "2", teacher: "בני"},
                    {course: "פילאטיס חט\"ב", variant: "2", teacher: "עירית"}
                ],
                "ו": []
            }
        };

        // משתמשים כרגע במערכת של כיתות ג-ד
        let rawScheduleData = scheduleData34;

        // משתנים גלובליים
        let processedData = [];
        let selectedCourses = {};
        let variantMap = {};
        let currentGradeLevel = '3-4'; // track which grade level is active

        // יצירת טבלת המערכת
        function createScheduleTable(gradeLevel = '3-4') {
            // Set the current grade level
            currentGradeLevel = gradeLevel;
            
            // Choose the appropriate data based on grade level
            if (gradeLevel === '5-6') {
                rawScheduleData = scheduleData56;
            } else if (gradeLevel === '7-9') {
                rawScheduleData = scheduleData79;
            } else {
                rawScheduleData = scheduleData34;
            }
            
            // Clear any existing selections when switching grade levels
            selectedCourses = {};
            
            // Update button states
            document.getElementById('processBtn34').classList.toggle('active', gradeLevel === '3-4');
            document.getElementById('processBtn56').classList.toggle('active', gradeLevel === '5-6');
            document.getElementById('processBtn79').classList.toggle('active', gradeLevel === '7-9');
            
            processVariants();
            
            const output = document.getElementById('output');
            output.style.display = 'block';
            
            let html = `
                <div class="sync-info">
                    <strong>🎓 מערכת פעילה: כיתות ${gradeLevel === '7-9' ? 'ז-ט' : gradeLevel === '5-6' ? 'ה-ו' : 'ג-ד'}</strong>
                    <br>
                    <strong>🔄 סנכרון אוטומטי:</strong> 
                    כשתבחר שיעור, כל המופעים שלו במערכת יסונכרנו אוטומטית
                    <br>
                    <span style="background-color: #ffe4b5; padding: 2px 5px;">כתום = בחירה ידנית</span>
                    <span style="background-color: #90ee90; padding: 2px 5px;">ירוק = סנכרון אוטומטי</span>
                </div>
                <div id="stats" class="stats"></div>
                <table id="scheduleTable">
                    <thead>
                        <tr>
                            <th>שעה</th>
                            <th>יום ראשון</th>
                            <th>יום שני</th>
                            <th>יום שלישי</th>
                            <th>יום רביעי</th>
                            <th>יום חמישי</th>
                            <th>יום שישי</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            const days = ['א', 'ב', 'ג', 'ד', 'ה', 'ו'];
            
            Object.keys(rawScheduleData).forEach(time => {
                html += `<tr>`;
                html += `<td class="time-cell">${time}</td>`;
                
                days.forEach(day => {
                    const options = rawScheduleData[time][day];
                    
                    if (options && options.length > 0) {
                        html += `<td>`;
                        html += `<select id="select_${time}_${day}" onchange="handleSelectionChange('${time}', '${day}')">`;
                        html += `<option value="">-- בחר שיעור --</option>`;
                        
                        options.forEach(option => {
                            const displayVariant = option.variant ? ` (${option.variant})` : '';
                            const value = `${option.course}|${option.variant}|${option.teacher}`;
                            html += `<option value="${value}">${option.course}${displayVariant} - ${option.teacher}</option>`;
                        });
                        
                        html += `</select>`;
                        html += `</td>`;
                    } else {
                        html += `<td>-</td>`;
                    }
                });
                
                html += `</tr>`;
            });
            
            html += `</tbody></table>`;
            output.innerHTML = html;
            
            updateStats();
        }

        // עיבוד וריאנטים
        function processVariants() {
            variantMap = {};
            let variantCounter = 200;
            
            // שלב ראשון: יצירת מפת וריאנטים לשיעורים רגילים
            Object.keys(rawScheduleData).forEach(timeSlot => {
                Object.values(rawScheduleData[timeSlot]).forEach(options => {
                    options.forEach(option => {
                        // מקרים מיוחדים שמקבלים וריאנט ייחודי כל פעם
                        const specialCourses = ["ספרייה", "ספריה", "פרלמנט", "פרלמנט/שעה דמוקרטית", "שעת חיבורים", "שעת ועדות"];
                        
                        if (specialCourses.includes(option.course)) {
                            option.variant = (variantCounter++).toString();
                        } else if (!option.variant) {
                            const key = `${option.course}_${option.teacher}`;
                            if (!variantMap[key]) {
                                variantMap[key] = variantCounter++;
                            }
                            option.variant = variantMap[key].toString();
                        }
                    });
                });
            });
        }

        // טיפול בשינוי בחירה
        function handleSelectionChange(time, day) {
            const select = document.getElementById(`select_${time}_${day}`);
            const value = select.value;
            
            if (!value) {
                // ביטול בחירה
                delete selectedCourses[`${time}_${day}`];
                select.style.backgroundColor = '';
                clearAutoSyncedRelated(time, day);
                updateStats();
                return;
            }
            
            const [course, variant, teacher] = value.split('|');
            
            // בדיקת התנגשויות
            const conflicts = checkForConflicts(course, variant, teacher, time, day);
            
            if (conflicts.length > 0) {
                const conflictMessages = conflicts.map(c => 
                    `• ${c.course} עם ${c.teacher} ביום ${getDayName(c.day)} בשעה ${c.time}`
                ).join('\n');
                
                const message = `השיעור "${course}" עם ${teacher} מתנגש עם:\n${conflictMessages}\n\nהאם ברצונך להחליף את השיעורים הקיימים בשיעור החדש?`;
                
                if (!confirm(message)) {
                    // ביטול הבחירה
                    select.value = '';
                    return;
                }
                
                // הסרת השיעורים המתנגשים
                conflicts.forEach(c => {
                    const conflictKey = `${c.time}_${c.day}`;
                    delete selectedCourses[conflictKey];
                    const conflictSelect = document.getElementById(`select_${c.time}_${c.day}`);
                    if (conflictSelect) {
                        conflictSelect.value = '';
                        conflictSelect.style.backgroundColor = '';
                    }
                });
            }
            
            // שמירת הבחירה
            selectedCourses[`${time}_${day}`] = {
                course: course,
                variant: variant,
                teacher: teacher,
                isAutoSynced: false
            };
            
            select.style.backgroundColor = '#ffe4b5'; // כתום לבחירה ידנית
            
            // סנכרון שיעורים זהים
            const synced = syncRelatedCourses(course, variant, teacher, time, day, true);
            
            updateStats();
            
            if (synced > 0) {
                console.log(`סונכרנו ${synced} שיעורים נוספים`);
            }
        }

        // פונקציה לבדיקת התנגשויות - עם התיקונים
        function checkForConflicts(course, variant, teacher, currentTime, currentDay) {
            const conflicts = [];
            
            // מקרים מיוחדים שלא צריכים לבדוק התנגשויות
            if (course === "ספרייה" || course === "ספריה" || course === "פרלמנט" || course === "פרלמנט/שעה דמוקרטית") {
                return conflicts; // ספרייה ופרלמנט לא יוצרים התנגשויות
            }
            
            // אם אין מורה מוגדר, אין התנגשות
            if (!teacher || teacher === '') {
                return conflicts;
            }
            
            Object.keys(selectedCourses).forEach(key => {
                const [time, day] = key.split('_');
                const selected = selectedCourses[key];
                
                // דלג על בדיקה עצמית
                if (time === currentTime && day === currentDay) {
                    return;
                }
                
                // התנגשות אמיתית: אותו מורה, אותו יום, אותה שעה, קורס שונה
                // התנגשות קורית רק כשהמורה צריך להיות בשני מקומות באותו זמן באותו יום!
                if (time === currentTime && 
                    day === currentDay &&  // שינוי קריטי: בדוק התנגשות רק באותו יום!
                    selected.teacher === teacher && 
                    selected.teacher !== '' &&
                    (selected.course !== course || selected.variant !== variant)) {
                    
                    conflicts.push({
                        course: selected.course,
                        teacher: selected.teacher,
                        time: time,
                        day: day,
                        type: 'teacher'
                    });
                }
            });
            
            return conflicts;
        }

        // סנכרון אוטומטי של שיעורים זהים - עם התיקונים
        function syncRelatedCourses(course, variant, teacher, currentTime, currentDay, isManual = false) {
            let synced = 0;
            
            // מקרים מיוחדים שלא מסנכרנים
            const noSyncCourses = ["ספרייה", "ספריה", "פרלמנט", "פרלמנט/שעה דמוקרטית", "שעת חיבורים", "שעת ועדות"];
            if (noSyncCourses.includes(course)) {
                return synced;
            }
            
            Object.keys(rawScheduleData).forEach(time => {
                Object.keys(rawScheduleData[time]).forEach(day => {
                    // דלג על המשבצת הנוכחית
                    if (time === currentTime && day === currentDay) {
                        return;
                    }
                    
                    const options = rawScheduleData[time][day];
                    const matchingOption = options.find(opt => 
                        opt.course === course && 
                        opt.variant === variant && 
                        opt.teacher === teacher
                    );
                    
                    if (matchingOption) {
                        const key = `${time}_${day}`;
                        
                        // בדוק התנגשויות רק עבור סנכרון אוטומטי
                        if (!isManual) {
                            // בדוק אם יש כבר בחירה אחרת במקום הזה
                            if (selectedCourses[key] && 
                                (selectedCourses[key].course !== course || 
                                 selectedCourses[key].variant !== variant)) {
                                // יש כבר שיעור אחר - לא מסנכרנים
                                return;
                            }
                        }
                        
                        selectedCourses[key] = {
                            course: course,
                            variant: variant,
                            teacher: teacher,
                            isAutoSynced: !isManual
                        };
                        
                        const select = document.getElementById(`select_${time}_${day}`);
                        if (select) {
                            select.value = `${course}|${variant}|${teacher}`;
                            select.style.backgroundColor = isManual ? '#ffe4b5' : '#90ee90';
                        }
                        synced++;
                    }
                });
            });
            
            return synced;
        }

        // ניקוי שיעורים מסונכרנים
        function clearAutoSyncedRelated(time, day) {
            const toRemove = [];
            
            Object.keys(selectedCourses).forEach(key => {
                if (selectedCourses[key].isAutoSynced && key !== `${time}_${day}`) {
                    toRemove.push(key);
                }
            });
            
            toRemove.forEach(key => {
                delete selectedCourses[key];
                const [t, d] = key.split('_');
                const select = document.getElementById(`select_${t}_${d}`);
                if (select) {
                    select.value = '';
                    select.style.backgroundColor = '';
                }
            });
        }

        // קבלת שם היום
        function getDayName(dayLetter) {
            const dayNames = {
                'א': 'ראשון',
                'ב': 'שני',
                'ג': 'שלישי',
                'ד': 'רביעי',
                'ה': 'חמישי',
                'ו': 'שישי'
            };
            return dayNames[dayLetter] || dayLetter;
        }

        // עדכון סטטיסטיקות
        function updateStats() {
            const manualSelections = Object.values(selectedCourses).filter(s => !s.isAutoSynced).length;
            const autoSynced = Object.values(selectedCourses).filter(s => s.isAutoSynced).length;
            const uniqueCourses = new Set(Object.values(selectedCourses).map(s => `${s.course}_${s.variant}`)).size;
            
            const statsDiv = document.getElementById('stats');
            if (statsDiv) {
                statsDiv.innerHTML = `
                    <strong>📊 סטטיסטיקות:</strong>
                    בחירות ידניות: ${manualSelections} | 
                    מסונכרנים: ${autoSynced} | 
                    סה"כ משבצות: ${Object.keys(selectedCourses).length} | 
                    קורסים ייחודיים: ${uniqueCourses}
                `;
            }
        }

        // ניקוי כל הבחירות
        function clearSelections() {
            if (confirm('האם אתה בטוח שברצונך לנקות את כל הבחירות?')) {
                selectedCourses = {};
                
                // ניקוי כל התפריטים
                const selects = document.querySelectorAll('select[id^="select_"]');
                selects.forEach(select => {
                    select.value = '';
                    select.style.backgroundColor = '';
                });
                
                updateStats();
            }
        }

        // הצגת מידע דיבאג
        function showDebugInfo() {
            console.log('Selected Courses:', selectedCourses);
            console.log('Variant Map:', variantMap);
            
            let debugInfo = 'שיעורים נבחרים:\n';
            Object.keys(selectedCourses).forEach(key => {
                const [time, day] = key.split('_');
                const course = selectedCourses[key];
                debugInfo += `${getDayName(day)} ${time}: ${course.course} (${course.variant}) - ${course.teacher} [${course.isAutoSynced ? 'מסונכרן' : 'ידני'}]\n`;
            });
            
            alert(debugInfo);
        }

        // ייצוא לאקסל
        function exportToExcel() {
            const data = [];
            const days = ['א', 'ב', 'ג', 'ד', 'ה', 'ו'];
            const dayNames = ['ראשון', 'שני', 'שלישי', 'רביעי', 'חמישי', 'שישי'];
            
            // כותרת
            data.push(['שעה', ...dayNames]);
            
            // נתונים
            Object.keys(rawScheduleData).forEach(time => {
                const row = [time];
                
                days.forEach(day => {
                    const key = `${time}_${day}`;
                    if (selectedCourses[key]) {
                        const course = selectedCourses[key];
                        const variant = course.variant ? ` (${course.variant})` : '';
                        row.push(`${course.course}${variant} - ${course.teacher}`);
                    } else {
                        row.push('');
                    }
                });
                
                data.push(row);
            });
            
            // המרה ל-CSV
            let csv = '\ufeff'; // BOM for Hebrew
            data.forEach(row => {
                csv += row.map(cell => `"${cell}"`).join(',') + '\n';
            });
            
            // הורדה
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'מערכת_שעות.csv';
            link.click();
        }
    </script>
</body>
</html>
